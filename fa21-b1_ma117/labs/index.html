<!doctype html>
<html>

<head>

<meta charset="UTF-8">

<link rel="stylesheet" href="/teaching/css/style.css" type="text/css" />

<!-- KaTeX -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.js" integrity="sha384-g7c+Jr9ZivxKLnZTDUhnkOnsh30B4H0rpLUpJ4jAIKs4fnJI+sEnkvrMWph2EDg4" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/contrib/auto-render.min.js" integrity="sha384-mll67QQFJfxn0IYznZYonOWZ644AWYC+Pt2cHqMaRhXVrursRwvLnLaebdGIlYNa" crossorigin="anonymous" onload="renderMathInElement(document.body);"></script>

<title>
 — 
</title>

</head>

<body>

<header id="banner">
<a href="teaching/fa21-b1_ma117"></a>
</header>

<main>
<style>
div.exercise {
    background-color: #eee;
    padding: 0.5em 1em;
    margin-top: 1em;
    margin-bottom: 1em;
    border-radius: 0.2em;
    counter-increment: exercise;
}

div.exercise::before {
    content: "Exercise " counter(lab) "." counter(exercise);
    font-weight: bold;
    font-size: small;
}

h2 {
    counter-increment: lab;
    counter-reset: exercise;
}

h2::before {
    content: "Lab " counter(lab) ": ";
}
</style>
<h1 id="labs">Labs</h1>
<p><em>Instructions.</em> For all of the labs, write up a complete
response to each exercise under the lab. If the exercise requires you to
write some R code that isn’t explicitly given to you, you should include
that R code. If the exercise asks you to generate a plot, include an
image of that plot.</p>
<div class="references" style="font-size: x-small;">
These labs are minor adaptations of the <a
href="https://www.openintro.org/book/os/">OpenIntro labs by Andrew Bray
and Mine Çetinkaya-Rundel</a>, some of which in turn are based on labs
by Mark Hansen, other faculty members, and TAs at UCLA Statistics. These
adaptations are all available under a <a
href="https://creativecommons.org/licenses/by-sa/3.0/">Creative Commons
Attribution-ShareAlike 3.0 Unported</a> license.
</div>
<h2 id="lab1">Introduction to R and RStudio</h2>
<p>The goal of this lab is to introduce you to R and RStudio, which
you’ll be using throughout the course both to learn the statistical
concepts discussed in the texbook and also to analyze real data and come
to informed conclusions. To straighten out which is which: R is the name
of the programming language itself and RStudio is a convenient
interface.</p>
<p>As the labs progress, you are encouraged to explore beyond what the
labs dictate; a willingness to experiment will make you a much better
programmer. Before we get to that stage, however, you need to build some
basic fluency in R. Today we begin with the fundamental building blocks
of R and RStudio: the interface, reading in data, and basic
commands.</p>
<p><img width="100%" src="1a.png"/></p>
<p>The panel in the upper right contains your workspace as well as a
history of the commands that you’ve previously entered. Any plots that
you generate will show up in the panel in the lower right corner.</p>
<p>The panel on the left is where the action happens. It’s called the
console. Everytime you launch RStudio, it will have the same text at the
top of the console telling you the version of R that you’re running.
Below that information is the prompt. As its name suggests, this prompt
is really a request, a request for a command. Initially, interacting
with R is all about typing commands and interpreting the output. These
commands and their syntax have evolved over decades (literally) and now
provide what many users feel is a fairly natural way to access data and
organize, describe, and invoke statistical computations.</p>
<h3 id="the-data-arbuthnots-baptism-records">The Data: Arbuthnot’s
Baptism Records</h3>
<p><a href="https://en.wikipedia.org/wiki/John_Arbuthnot">Dr
Arbuthnot</a> (1667–1735) was a physician, writer, and mathematician. He
was interested in the ratio of newborn boys to newborn girls, so he
gathered the baptism records for children born in London for every year
from 1629 to 1710.</p>
<p>This data is recorded in the <a
href="arbuthnot.csv"><code>arbuthnot.csv</code></a> file. The
<code>csv</code> extension for “comma-separated values,” and a
<code>csv</code> file is just a plain text file format used to record
data frames. The first line in the file records the variable names
(separated by commas), and then each subsequent row records observations
(again, separated by values). The first few lines in
<code>arbuthnot.csv</code> look like this:</p>
<pre><code>&quot;year&quot;,&quot;boys&quot;,&quot;girls&quot;
1629,5218,4683
1630,4858,4457
1631,4422,4102
1632,4994,4590</code></pre>
<p>To load the data frame into R, enter the following command into R
prompt:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>arbuthnot <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://sagrawalx.github.io/teaching/fa21-b1_ma117/labs/arbuthnot.csv&quot;</span>)</span></code></pre></div>
<p>The <code>read.csv</code> function tells R to read the
<code>csv</code> file whose path is provided inside the brackets and
quotes. That path can be a path to a <code>csv</code> file on your
computer (eg, <code>read.csv("~/Downloads/arbuthnot.csv")</code>), or it
can be a path to a <code>csv</code> file on the web like above. The
<code>&lt;-</code> symbol tells R to store the data from that
<code>csv</code> file into a variable called <code>arbuthnot</code>.</p>
<p>You should see that the workspace area in the upper righthand corner
of the RStudio window now lists a data frame called arbuthnot that has
82 observations on 3 variables. You can take a look at the data frame by
typing its name into the console.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>arbuthnot</span></code></pre></div>
<p>What you should see are four columns of numbers, each row
representing a different year: the first entry in each row is simply the
row number (an index we can use to access the data from individual years
if we want), the second is the year, and the third and fourth are the
numbers of boys and girls baptized that year, respectively. Use the
scrollbar on the right side of the console window to examine the
complete data set.</p>
<p>Note that the row numbers in the first column are not part of
Arbuthnot’s data. R adds them as part of its printout to help you make
visual comparisons. You can think of them as the index that you see on
the left side of a spreadsheet. In fact, the comparison to a spreadsheet
will generally be helpful. R has stored Arbuthnot’s data in a kind of
spreadsheet or table called a data frame.</p>
<h3 id="some-exploration">Some Exploration</h3>
<p>You can see the dimensions of this data frame by typing:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(arbuthnot)</span></code></pre></div>
<p>This command should output <code>[1] 82 3</code>, indicating that
there are 82 rows and 3 columns (we’ll get to what the <code>[1]</code>
means in a bit), just as it says next to the object in your workspace.
You can see the names of these columns (or variables) by typing:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(arbuthnot)</span></code></pre></div>
<p>You should see that the data frame contains the columns year, boys,
and girls. At this point, you might notice that many of the commands in
R look a lot like functions from math class; that is, invoking R
commands means supplying a function with some number of arguments. The
dim and names commands, for example, each took a single argument, the
name of a data frame.</p>
<p>One advantage of RStudio is that it comes with a built-in data
viewer. Click on the name <code>arbuthnot</code> in the Environment pane
(upper right window) that lists the objects in your workspace. This will
bring up an alternative display of the data set in the Data Viewer
(upper left window). You can close the data viewer by clicking on the
<em>x</em> in the upper lefthand corner.</p>
<p>Let’s start to examine the data a little more closely. We can access
the data in a single column of a data frame separately using a command
like</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>arbuthnot<span class="sc">$</span>boys</span></code></pre></div>
<p>This command will only show the number of boys baptized each
year.</p>
<div class="exercise">
<p>What command would you use to extract just the counts of girls
baptized? Try it!</p>
</div>
<p>Notice that the way R has printed these data is different. When we
looked at the complete data frame, we saw 82 rows, one on each line of
the display. These data are no longer structured in a table with other
variables, so they are displayed one right after another. Objects that
print out in this way are called <em>vectors</em>; they represent a set
of numbers. R has added numbers in [brackets] along the left side of the
printout to indicate locations within the vector. For example,
<code>5218</code> follows <code>[1]</code>, indicating that
<code>5218</code> is the first entry in the vector. And if
<code>[43]</code> starts a line, then that would mean the first number
on that line would represent the 43rd entry in the vector.</p>
<p>R has some powerful functions for making graphics. We can create a
simple plot of the number of girls baptized per year with the
command</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> arbuthnot<span class="sc">$</span>year, <span class="at">y =</span> arbuthnot<span class="sc">$</span>girls)</span></code></pre></div>
<p>By default, R creates a scatterplot with each x,y pair indicated by
an open circle. The plot itself should appear under the Plots tab of the
lower right panel of RStudio. Notice that the command above again looks
like a function, this time with two arguments separated by a comma. The
first argument in the plot function specifies the variable for the
x-axis and the second for the y-axis. If we wanted to connect the data
points with lines, we could add a third argument, the letter
<code>l</code> for line.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(<span class="at">x =</span> arbuthnot<span class="sc">$</span>year, <span class="at">y =</span> arbuthnot<span class="sc">$</span>girls, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p>You might wonder how you are supposed to know that it was possible to
add that third argument. Thankfully, R documents all of its functions
extensively. To read what a function does and learn the arguments that
are available to you, just type in a question mark followed by the name
of the function that you’re interested in. Try the following.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>?plot</span></code></pre></div>
<p>Notice that the help file replaces the plot in the lower right panel.
You can toggle between plots and help files using the tabs at the top of
that panel.</p>
<div class="exercise">
<p>Is there an apparent trend in the number of girls baptized over the
years? How would you describe it?</p>
</div>
<p>Now, suppose we want to plot the total number of baptisms. To compute
this, we could use the fact that R is really just a big calculator. We
can type in mathematical expressions like</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="dv">5218</span> <span class="sc">+</span> <span class="dv">4683</span></span></code></pre></div>
<p>to see the total number of baptisms in 1629. We could repeat this
once for each year, but there is a faster way. If we add the vector for
baptisms for boys and girls, R will compute all sums simultaneously.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>arbuthnot<span class="sc">$</span>boys <span class="sc">+</span> arbuthnot<span class="sc">$</span>girls</span></code></pre></div>
<p>What you will see are 82 numbers (in that packed display, because we
aren’t looking at a data frame here), each one representing the sum
we’re after. Take a look at a few of them and verify that they are
right. Therefore, we can make a plot of the total number of baptisms per
year with the command:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(arbuthnot<span class="sc">$</span>year, arbuthnot<span class="sc">$</span>boys <span class="sc">+</span> arbuthnot<span class="sc">$</span>girls, <span class="at">type =</span> <span class="st">&quot;l&quot;</span>)</span></code></pre></div>
<p>This time, note that we left out the names of the first two
arguments. We can do this because the help file shows that the default
for <code>plot</code> is for the first argument to be the x-variable and
the second argument to be the y-variable.</p>
<p>Similarly to how we computed the proportion of boys, we can compute
the ratio of the number of boys to the number of girls baptized in 1629
with</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="dv">5218</span> <span class="sc">/</span> <span class="dv">4683</span></span></code></pre></div>
<p>or we can act on the complete vectors with the expression</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>arbuthnot<span class="sc">$</span>boys <span class="sc">/</span> arbuthnot<span class="sc">$</span>girls</span></code></pre></div>
<p>The proportion of newborns that are boys</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="dv">5218</span> <span class="sc">/</span> (<span class="dv">5218</span> <span class="sc">+</span> <span class="dv">4683</span>)</span></code></pre></div>
<p>or this may also be computed for all years simultaneously:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>arbuthnot<span class="sc">$</span>boys <span class="sc">/</span> (arbuthnot<span class="sc">$</span>boys <span class="sc">+</span> arbuthnot<span class="sc">$</span>girls)</span></code></pre></div>
<p>Note that with R as with your calculator, you need to be conscious of
the order of operations. Here, we want to divide the number of boys by
the total number of newborns, so we have to use parentheses. Without
them, R will first do the division, then the addition, giving you
something that is not a proportion.</p>
<div class="exercise">
<p>Make a plot of the proportion of boys over time. What do you see?</p>
<p>Tip: If you use the up and down arrow keys, you can scroll through
your previous commands, your so-called <em>command history</em>. You can
also access it by clicking on the history tab in the upper right panel.
This will save you a lot of typing in the future.</p>
</div>
<p>Finally, in addition to simple mathematical operators like
subtraction and division, you can ask R to make comparisons like greater
than <code>&gt;</code>, less than <code>&lt;</code>, and equality
<code>==</code>. For example, we can ask if boys outnumber girls in each
year with the expression</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>arbuthnot<span class="sc">$</span>boys <span class="sc">&gt;</span> arbuthnot<span class="sc">$</span>girls</span></code></pre></div>
<p>This command returns 82 values of either <code>TRUE</code> if that
year had more boys than girls, or <code>FALSE</code> if that year did
not (the answer may surprise you). This output shows a different kind of
data than we have considered so far. In the <code>arbuthnot</code> data
frame our values are numerical (the year, the number of boys and girls).
Here, we’ve asked R to create logical data, data where the values are
either <code>TRUE</code> or <code>FALSE</code>. In general, data
analysis will involve many different kinds of data types, and one reason
for using R is that it is able to represent and compute with many of
them.</p>
<h3 id="another-data-set">Another Data Set</h3>
<p>The next few exercises involve repeating some of the above steps but
for present-day birth records in the United States. These data come from
<a href="http://www.cdc.gov/nchs/data/nvsr/nvsr53/nvsr53_20.pdf">a
report by the Centers for Disease Control</a>. Check it out if you would
like to read more about an analysis of sex ratios at birth in the United
States.</p>
<div class="exercise">
<p>Load up the data frame stored in <a
href="present.csv"><code>https://sagrawalx.github.io/teaching/fa21-b1_ma117/labs/present.csv</code></a>
and store it in a variable called <code>present</code>.</p>
</div>
<div class="exercise">
<p>What years are included in this data set? What are the dimensions of
the data frame and what are the variable or column names?</p>
</div>
<div class="exercise">
<p>How do the birth counts compare to Arbuthnot’s? Are they on a similar
scale?</p>
</div>
<div class="exercise">
<p>Make a plot that displays the boy-to-girl ratio for every year in the
data set. What do you see?</p>
<p>Note: You may be surprised by the result, especially if you’re aware
of issues involving sex-selective abortion in some developing countries.
You may find it useful to look through <a
href="https://ourworldindata.org/gender-ratio">this article</a> if you
find yourself puzzled.</p>
</div>
<div class="exercise">
<p>In what year did we see the most total number of births in the
US?</p>
<p>Note: You can refer to the help files or the <a
href="http://cran.r-project.org/doc/contrib/Short-refcard.pdf">R
reference card</a> to find helpful commands.</p>
</div>
<h2 id="lab2">Introduction to data</h2>
<p>Some define statistics as the field that focuses on turning
information into knowledge. The first step in that process is to
summarize and describe the raw information — the data. In this lab, you
will gain insight into public health by generating simple graphical and
numerical summaries of a data set collected by the Centers for Disease
Control and Prevention (CDC). As this is a large data set, along the way
you’ll also learn the indispensable skills of data processing and
subsetting.</p>
<h3 id="behavioral-risk-factor-surveillance-system">Behavioral Risk
Factor Surveillance System</h3>
<p>The Behavioral Risk Factor Surveillance System (BRFSS) is an annual
telephone survey of 350,000 people in the United States. As its name
implies, the BRFSS is designed to identify risk factors in the adult
population and report emerging health trends. For example, respondents
are asked about their diet and weekly physical activity, their HIV/AIDS
status, possible tobacco use, and even their level of healthcare
coverage. The <a href="http://www.cdc.gov/brfss">BRFSS website</a>
contains a complete description of the survey, including the research
questions that motivate the study and many interesting results derived
from the data.</p>
<p>We will focus on a random sample of 20,000 people from the BRFSS
survey conducted in 2000. While there are over 200 variables in this
data set, we will work with a small subset. Load the data set from the
<code>csv</code> file at <a
href="cdc.csv"><code>https://sagrawalx.github.io/teaching/fa21-b1_ma117/labs/cdc.csv</code></a>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>cdc <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://sagrawalx.github.io/teaching/fa21-b1_ma117/labs/cdc.csv&quot;</span>)</span></code></pre></div>
<p>The data set <code>cdc</code> that shows up in your workspace is a
data matrix, with each row representing a case and each column
representing a variable. R calls this data format a data frame, which is
a term that will be used throughout the labs.</p>
<p>To view the names of the variables, type the command</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cdc)</span></code></pre></div>
<p>This returns the names <code>genhlth</code>, <code>exerany</code>,
<code>hlthplan</code>, <code>smoke100</code>, <code>height</code>,
<code>weight</code>, <code>wtdesire</code>, <code>age</code>, and
<code>gender</code>. Each one of these variables corresponds to a
question that was asked in the survey. For example:</p>
<ul>
<li>For <code>genhlth</code>, respondents were asked to evaluate their
general health, responding either <code>excellent</code>,
<code>very good</code>, <code>good</code>, <code>fair</code> or
<code>poor</code>.</li>
<li>The <code>exerany</code> variable indicates whether the respondent
exercised in the past month (<code>1</code>) or did not
(<code>0</code>).</li>
<li><code>hlthplan</code> indicates whether the respondent had some form
of health coverage (<code>1</code>) or did not (<code>0</code>).</li>
<li>The <code>smoke100</code> variable indicates whether the respondent
had smoked at least 100 cigarettes in her lifetime.</li>
</ul>
<p>The other variables record the respondent’s <code>height</code> in
inches, <code>weight</code> in pounds as well as their desired weight
<code>wtdesire</code>, <code>age</code> in years, and
<code>gender</code>.</p>
<div class="exercise">
<p>How many cases (ie, observations) are there in this data set? How
many variables? Determine whether each variable is categorical or
numerical.</p>
</div>
<p>We can have a look at the first few entries (rows) of our data with
the command</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(cdc)</span></code></pre></div>
<p>and similarly we can look at the last few by typing</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(cdc)</span></code></pre></div>
<p>You could also look at all of the data frame at once by typing its
name into the console, but that might be unwise here. We know
<code>cdc</code> has 20,000 rows, so viewing the entire data set would
mean flooding your screen. It’s better to take small peeks at the data
with head, tail or the subsetting techniques that you’ll learn in a
moment.</p>
<h3 id="summaries-and-tables">Summaries and tables</h3>
<p>The BRFSS questionnaire is a massive trove of information. A good
first step in any analysis is to distill all of that information into a
few summary statistics and graphics. As a simple example, the function
summary returns a numerical summary: minimum, first quartile, median,
mean, second quartile, and maximum. For weight this is</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cdc<span class="sc">$</span>weight)</span></code></pre></div>
<p>R also functions like a very fancy calculator. If you wanted to
compute the interquartile range for the respondents’ weights, you would
look at the output from the summary command above and then enter</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="dv">190</span> <span class="sc">-</span> <span class="dv">140</span></span></code></pre></div>
<p>R also has built-in functions to compute summary statistics one by
one. For instance, to calculate the mean, median, and variance of
weight, type</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(cdc<span class="sc">$</span>weight) </span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">var</span>(cdc<span class="sc">$</span>weight)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="fu">median</span>(cdc<span class="sc">$</span>weight)</span></code></pre></div>
<p>While it makes sense to describe a quantitative variable like weight
in terms of these statistics, what about categorical data? We would
instead consider the sample frequency or relative frequency
distribution. The function table does this for you by counting the
number of times each kind of response was given. For example, to see the
number of people who have smoked 100 cigarettes in their lifetime,
type</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cdc<span class="sc">$</span>smoke100)</span></code></pre></div>
<p>or instead look at the relative frequency distribution by typing</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cdc<span class="sc">$</span>smoke100)<span class="sc">/</span><span class="dv">20000</span></span></code></pre></div>
<p>Notice how R automatically divides all entries in the table by 20,000
in the command above. This is similar to something we observed in the
lab above, “Introduction to R;” when we multiplied or divided a vector
with a number, R applied that action across entries in the vectors. As
we see above, this also works for tables. Next, we make a bar plot of
the entries in the table by putting the table inside the barplot
command.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(cdc<span class="sc">$</span>smoke100))</span></code></pre></div>
<p>Notice what we’ve done here! We’ve computed the table of
<code>cdc$smoke100</code> and then immediately applied the graphical
function, barplot. This is an important idea: R commands can be nested.
You could also break this into two steps by typing the following:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>smoke <span class="ot">&lt;-</span> <span class="fu">table</span>(cdc<span class="sc">$</span>smoke100)</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(smoke)</span></code></pre></div>
<p>Here, we’ve made a new object, a table, called smoke (the contents of
which we can see by typing smoke into the console) and then used it in
as the input for barplot. The special symbol <code>&lt;-</code> performs
an assignment, taking the output of one line of code and saving it into
an object in your workspace. This is another important idea that we’ll
return to later.</p>
<div class="exercise">
<p>Create a numerical summary for <code>height</code> and
<code>age</code>, and compute the interquartile range for each. Compute
the relative frequency distribution for <code>gender</code> and
<code>exerany</code>. How many males are in the sample? What proportion
of the sample reports being in excellent health?</p>
</div>
<p>The <code>table</code> command can be used to tabulate any number of
variables that you provide. For example, to examine which participants
have smoked across each <code>gender</code>, we could use the
following.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(cdc<span class="sc">$</span>gender,cdc<span class="sc">$</span>smoke100)</span></code></pre></div>
<p>Here, we see column labels of <code>0</code> and <code>1</code>.
Recall that <code>1</code> indicates a respondent has smoked at least
100 cigarettes. The rows refer to gender. To create a mosaic plot of
this table, we would enter the following command.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mosaicplot</span>(<span class="fu">table</span>(cdc<span class="sc">$</span>gender,cdc<span class="sc">$</span>smoke100))</span></code></pre></div>
<p>We could have accomplished this in two steps by saving the table in
one line and applying <code>mosaicplot</code> in the next (see the
table/barplot example above).</p>
<div class="exercise">
<p>What does the mosaic plot reveal about smoking habits and gender?</p>
</div>
<h3 id="interlude-how-r-thinks-about-data">Interlude: How R thinks about
data</h3>
<p>We mentioned that R stores data in data frames, which you might think
of as a type of spreadsheet. Each row is a different observation (a
different respondent) and each column is a different variable (the first
is <code>genhlth</code>, the second <code>exerany</code>, and so on). We
can see the size of the data frame next to the object name in the
workspace or we can type</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(cdc)</span></code></pre></div>
<p>which will return the number of rows and columns. Now, if we want to
access a subset of the full data frame, we can use row-and-column
notation. For example, to see the sixth variable of the 567th
respondent, use the format</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>cdc[<span class="dv">567</span>,<span class="dv">6</span>]</span></code></pre></div>
<p>which means we want the element of our data set that is in the 567th
row (meaning the 567th person or observation) and the 6th column (in
this case, weight). We know that weight is the 6th variable because it
is the 6th entry in the list of variable names</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(cdc)</span></code></pre></div>
<p>To see the weights for the first 10 respondents we can type</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>cdc[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,<span class="dv">6</span>]</span></code></pre></div>
<p>In this expression, we have asked just for rows in the range 1
through 10. R uses the <code>:</code> to create a range of values, so
<code>1:10</code> expands to <code>1, 2, 3, 4, 5, 6, 7, 8, 9, 10</code>.
You can see this by entering</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span></code></pre></div>
<p>Finally, if we want all of the data for the first 10 respondents,
type</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>cdc[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>,]</span></code></pre></div>
<p>By leaving out an index or a range (we didn’t type anything between
the comma and the square bracket), we get all the columns. When starting
out in R, this is a bit counterintuitive. As a rule, we omit the column
number to see all columns in a data frame. Similarly, if we leave out an
index or range for the rows, we would access all the observations, not
just the 567th, or rows 1 through 10. Try the following to see the
weights for all 20,000 respondents fly by on your screen:</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>cdc[,<span class="dv">6</span>]</span></code></pre></div>
<p>Recall that column 6 represents respondents’ weight, so the command
above reported all of the weights in the data set. An alternative method
to access the weight data is by referring to the name. Previously, we
typed <code>names(cdc)</code> to see all the variables contained in the
cdc data set. We can use any of the variable names to select items in
our data set.</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a>cdc<span class="sc">$</span>weight</span></code></pre></div>
<p>The dollar-sign tells R to look in data frame cdc for the column
called weight. Since that’s a single vector, we can subset it with just
a single index inside square brackets. We see the weight for the 567th
respondent by typing</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>cdc<span class="sc">$</span>weight[<span class="dv">567</span>]</span></code></pre></div>
<p>Similarly, for just the first 10 respondents</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>cdc<span class="sc">$</span>weight[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<p>The command above returns the same result as the
<code>cdc[1:10,6]</code> command. Both row-and-column notation and
dollar-sign notation are widely used, which one you choose to use
depends on your personal preference.</p>
<h3 id="a-little-more-on-subsetting">A little more on subsetting</h3>
<p>It’s often useful to extract all individuals (cases) in a data set
that have specific characteristics. We accomplish this through
conditioning commands. First, consider expressions like</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>cdc<span class="sc">$</span>gender <span class="sc">==</span> <span class="st">&quot;m&quot;</span></span></code></pre></div>
<p>or</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>cdc<span class="sc">$</span>age <span class="sc">&gt;</span> <span class="dv">30</span></span></code></pre></div>
<p>These commands produce a series of <code>TRUE</code> and
<code>FALSE</code> values. There is one value for each respondent, where
TRUE indicates that the person was male (via the first command) or older
than 30 (second command).</p>
<p>Suppose we want to extract just the data for the men in the sample,
or just for those over 30. We can use the R function <code>subset</code>
to do that for us. For example, the command</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>mdata <span class="ot">&lt;-</span> <span class="fu">subset</span>(cdc, gender <span class="sc">==</span> <span class="st">&quot;m&quot;</span>)</span></code></pre></div>
<p>will create a new data set called <code>mdata</code> that contains
only the men from the <code>cdc</code> data set. In addition to finding
it in your workspace alongside its dimensions, you can take a peek at
the first several rows as usual</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(mdata)</span></code></pre></div>
<p>This new data set contains all the same variables but just under half
the rows. It is also possible to tell R to keep only specific variables,
which is a topic we’ll discuss in a future lab. For now, the important
thing is that we can carve up the data based on values of one or more
variables.</p>
<p>As an aside, you can use several of these conditions together with
<code>&amp;</code> and <code>|</code>. The <code>&amp;</code> is read
“and” so that</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>m_and_over30 <span class="ot">&lt;-</span> <span class="fu">subset</span>(cdc, gender <span class="sc">==</span> <span class="st">&quot;m&quot;</span> <span class="sc">&amp;</span> age <span class="sc">&gt;</span> <span class="dv">30</span>)</span></code></pre></div>
<p>will give you the data for men over the age of 30. The <code>|</code>
character is read “or” so that</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>m_or_over30 <span class="ot">&lt;-</span> <span class="fu">subset</span>(cdc, gender <span class="sc">==</span> <span class="st">&quot;m&quot;</span> <span class="sc">|</span> age <span class="sc">&gt;</span> <span class="dv">30</span>)</span></code></pre></div>
<p>will take people who are men or over the age of 30 or both (why
that’s an interesting group is hard to say, but right now the mechanics
of this are the important thing). In principle, you may use as many
“and” and “or” clauses as you like when forming a subset.</p>
<div class="exercise">
<p>Create a new object called <code>under23_and_smoke</code> that
contains all observations of respondents under the age of 23 that have
smoked 100 cigarettes in their lifetime. Write the command you used to
create the new object as the answer to this exercise.</p>
</div>
<h3 id="quantitative-data">Quantitative data</h3>
<p>With our subsetting tools in hand, we’ll now return to the task of
the day: making basic summaries of the BRFSS questionnaire. We’ve
already looked at categorical data such as smoke and gender so now let’s
turn our attention to quantitative data. Two common ways to visualize
quantitative data are with box plots and histograms. We can construct a
box plot for a single variable with the following command.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(cdc<span class="sc">$</span>height)</span></code></pre></div>
<p>You can compare the locations of the components of the box by
examining the summary statistics.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(cdc<span class="sc">$</span>height)</span></code></pre></div>
<p>Confirm that the median and upper and lower quartiles reported in the
numerical summary match those in the graph. The purpose of a boxplot is
to provide a thumbnail sketch of a variable for the purpose of comparing
across several categories. So we can, for example, compare the heights
of men and women with</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(cdc<span class="sc">$</span>height <span class="sc">~</span> cdc<span class="sc">$</span>gender)</span></code></pre></div>
<p>The notation here is new. The <code>~</code> character can be read
“versus” or “as a function of.” So we’re asking R to give us a box plots
of heights where the groups are defined by gender.</p>
<p>Next let’s consider a new variable that doesn’t show up directly in
this data set: <a
href="http://en.wikipedia.org/wiki/Body_mass_index">Body Mass Index
(BMI)</a>. BMI is a weight to height ratio and can be calculated as:</p>
<p><span class="math display">\[ \text{BMI} = 703 \cdot
\frac{\text{weight in lbs}}{(\text{height in ins})^2}. \]</span></p>
<p>Note: The 703 is the approximate conversion factor to change units
from metric (meters and kilograms) to US customary (inches and
pounds).</p>
<p>The following two lines first make a new object called bmi and then
creates box plots of these values, defining groups by the variable
<code>cdc$genhlth</code>.</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>bmi <span class="ot">&lt;-</span> (cdc<span class="sc">$</span>weight <span class="sc">/</span> cdc<span class="sc">$</span>height<span class="sc">^</span><span class="dv">2</span>) <span class="sc">*</span> <span class="dv">703</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a><span class="fu">boxplot</span>(bmi <span class="sc">~</span> cdc<span class="sc">$</span>genhlth)</span></code></pre></div>
<p>Notice that the first line above is just some arithmetic, but it’s
applied to all 20,000 numbers in the cdc data set. That is, for each of
the 20,000 participants, we take their weight, divide by their
height-squared and then multiply by 703. The result is 20,000 BMI
values, one for each respondent. This is one reason why we like R: it
lets us perform computations like this using very simple
expressions.</p>
<div class="exercise">
<p>What does this box plot show? Pick another categorical variable from
the data set and see how it relates to BMI. List the variable you chose,
why you might think it would have a relationship to BMI, and indicate
what the figure seems to suggest.</p>
</div>
<p>Finally, let’s make some histograms. We can look at the histogram for
the age of our respondents with the command</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(cdc<span class="sc">$</span>age)</span></code></pre></div>
<p>Histograms are generally a very good way to see the shape of a single
distribution, but that shape can change depending on how the data is
split between the different bins. You can control the number of bins by
adding an argument to the command. In the next two lines, we first make
a default histogram of <code>bmi</code> and then one with 50 breaks.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(bmi)</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(bmi, <span class="at">breaks =</span> <span class="dv">50</span>)</span></code></pre></div>
<p>Note that you can flip between plots that you’ve created by clicking
the forward and backward arrows in the lower right region of RStudio,
just above the plots. How do these two histograms compare?</p>
<p>At this point, we’ve done a good first pass at analyzing the
information in the BRFSS questionnaire. We’ve found an interesting
association between smoking and gender, and we can say something about
the relationship between people’s assessment of their general health and
their own BMI. We’ve also picked up essential computing tools — summary
statistics, subsetting, and plots — that will serve us well throughout
this course.</p>
<div class="exercise">
<p>Make a scatterplot of weight versus desired weight. Describe the
relationship between these two variables.</p>
</div>
<div class="exercise">
<p>Let’s consider a new variable: the difference between desired weight
(<code>wtdesire</code>) and current weight (<code>weight</code>). Create
this new variable by subtracting the two columns in the data frame and
assigning them to a new object called <code>wdiff</code>.</p>
</div>
<div class="exercise">
<p>What type of data is <code>wdiff</code>? If an observation
<code>wdiff</code> is 0, what does this mean about the person’s weight
and desired weight? What if <code>wdiff</code> is positive or
negative?</p>
</div>
<div class="exercise">
<p>Describe the distribution of <code>wdiff</code> in terms of its
center, shape, and spread, including any plots you use. What does this
tell us about how people feel about their current weight?</p>
</div>
<div class="exercise">
<p>Using numerical summaries and a side-by-side box plot, determine if
men tend to view their weight differently than women.</p>
<p>Note: You might find it convenient to start by adding a column
corresponding to <code>wdiff</code> to the cdc data frame. To do that,
just type <code>cdc$wdiff &lt;- wdiff</code>.</p>
</div>
<div class="exercise">
<p>Now it’s time to get creative. Find the mean and standard deviation
of weight, and then determine what proportion of the weights are within
one standard deviation of the mean.</p>
</div>
<h2 id="lab3">Probability</h2>
<h3 id="hot-hands">Hot Hands</h3>
<p>Basketball players who make several baskets in succession are
described as having a <em>hot hand</em>. Fans and players have long
believed in the hot hand phenomenon, which refutes the assumption that
each shot is independent of the next. However, a 1985 paper by Gilovich,
Vallone, and Tversky collected evidence that contradicted this belief
and showed that successive shots are independent events (cf. <a
href="https://doi.org/10.1016/0010-0285(85)90010-6">doi:10.1016/0010-0285(85)90010-6</a>).
This paper started a great controversy that continues to this day, as
you can see by googling hot hand basketball.</p>
<p>We do not expect to resolve this controversy today. However, in this
lab we’ll apply one approach to answering questions like this. The goals
for this lab are to (1) think about the effects of independent and
dependent events, (2) learn how to simulate shooting streaks in R, and
(3) to compare a simulation to actual data in order to determine if the
hot hand phenomenon appears to be real.</p>
<h3 id="saving-your-code">Saving Your Code</h3>
<p>Click on File -&gt; New -&gt; R Script. This will open a blank
document above the console. As you go along you can copy and paste your
code here and save it. This is a good way to keep track of your code and
be able to reuse it later. To run your code from this document you can
copy and paste it into the console. Alternatively, you can highlight the
code and either hit Cmd+Enter (Mac) or Ctrl+Enter (Windows/Linux).</p>
<p>You’ll also want to save this script (code document). To do so click
on the disk icon. The first time you hit save, RStudio will ask for a
file name; you can name it anything you like. Once you hit save you’ll
see the file appear under the Files tab in the lower right panel. You
can reopen this file anytime by simply clicking on it.</p>
<h3 id="getting-started">Getting Started</h3>
<p>Our investigation will focus on the performance of one player: Kobe
Bryant of the Los Angeles Lakers. His performance against the Orlando
Magic in the 2009 NBA finals earned him the title Most Valuable Player
and many spectators commented on how he appeared to show a hot hand.
Let’s load some data from those games and look at the first several
rows.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>kobe <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://sagrawalx.github.io/teaching/fa21-b1_ma117/labs/kobe.csv&quot;</span>)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(kobe)</span></code></pre></div>
<p>In this data frame, every row records a shot taken by Kobe Bryant. If
he hit the shot (made a basket), a hit <code>H</code> is recorded in the
column named <code>basket</code>; otherwise a miss <code>M</code> is
recorded.</p>
<p>Just looking at the string of hits and misses, it can be difficult to
gauge whether or not it seems like Kobe was shooting with a hot hand.
One way we can approach this is by considering the belief that hot hand
shooters tend to go on shooting streaks. For this lab, we define the
length of a shooting streak to be the number of consecutive baskets made
until a miss occurs.</p>
<p>For example, in Game 1 Kobe had the following sequence of hits and
misses from his nine shot attempts in the first quarter:</p>
<p>H M | M | H H M | M | M | M</p>
<p>To verify this use the following command:</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>kobe<span class="sc">$</span>basket[<span class="dv">1</span><span class="sc">:</span><span class="dv">9</span>]</span></code></pre></div>
<p>Within the nine shot attempts, there are six streaks, which are
separated by a “|” above. Their lengths are one, zero, two, zero, zero,
zero (in order of occurrence).</p>
<div class="exercise">
<p>What does a streak length of 1 mean, i.e. how many hits and misses
are in a streak of 1? What about a streak length of 0?</p>
</div>
<p>Let’s now define a function, <code>streak_lengths</code>, which will
go take as input a sequence of <code>H</code>s and <code>M</code>s (like
<code>kobe$basket</code>). It’ll then output a list of all of the streak
lengths. Copy the following into the console. You don’t need to
understand how this works, but if you’re interested in programming,
you’ll probably enjoy trying to puzzle out what’s going on here.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>streak_lengths <span class="ot">=</span> <span class="cf">function</span>(seq) {</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>  seq <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;M&quot;</span>,<span class="fu">as.character</span>(seq),<span class="st">&quot;M&quot;</span>)</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>  booleanized <span class="ot">&lt;-</span> (seq <span class="sc">==</span> <span class="st">&quot;M&quot;</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>  misses <span class="ot">&lt;-</span> <span class="fu">which</span>(booleanized)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(<span class="fu">diff</span>(misses) <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Now that this function is defined, we can use it any time we want.
Let’s use it to calculate all of Kobe’s streak lengths and make a bar
plot.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>kobe_streaks <span class="ot">&lt;-</span> <span class="fu">streak_lengths</span>(kobe<span class="sc">$</span>basket)</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">barplot</span>(<span class="fu">table</span>(kobe_streaks))</span></code></pre></div>
<p>Note that instead of making a histogram, we chose to make a bar plot
from a table of the streak data. A bar plot is preferable here since our
variable is discrete rather than continuous.</p>
<div class="exercise">
<p>Describe the distribution of Kobe’s streak lengths from the 2009 NBA
finals. What was his typical streak length? How long was his longest
streak of baskets?</p>
</div>
<h3 id="compared-to-what">Compared to what?</h3>
<p>We’ve shown that Kobe had some long shooting streaks, but are they
long enough to support the belief that he had hot hands? What can we
compare them to?</p>
<p>To answer these questions, let’s return to the idea of independence.
Two processes are independent if the outcome of one process doesn’t
effect the outcome of the second. If each shot that a player takes is an
independent process, having made or missed your first shot will not
affect the probability that you will make or miss your second shot.</p>
<p>A shooter with a hot hand will have shots that are not independent of
one another. Specifically, if the shooter makes his first shot, the hot
hand model says he will have a higher probability of making his second
shot.</p>
<p>Let’s suppose for a moment that the hot hand model is valid for Kobe.
During his career, the percentage of time Kobe makes a basket (i.e. his
shooting percentage) is about 45%, or in probability notation,</p>
<p><span class="math display">\[ P(\text{shot 1} = \text{H})=0.45
\]</span></p>
<p>If he makes the first shot and has a hot hand (not independent
shots), then the probability that he makes his second shot would go up
to, let’s say, 60%,</p>
<p><span class="math display">\[ P(\text{shot 2} = \text{H} \mid
\text{shot 1} = \text{H})=0.60 \]</span></p>
<p>As a result of these increased probabilites, you’d expect Kobe to
have longer streaks. Compare this to the skeptical perspective where
Kobe does not have a hot hand, where each shot is independent of the
next. If he hit his first shot, the probability that he makes the second
is still 0.45.</p>
<p><span class="math display">\[ P(\text{shot 2} = \text{H}
\mid  \text{shot 1} = \text{H})=0.45 \]</span></p>
<p>In other words, making the first shot did nothing to effect the
probability that he’d make his second shot. If Kobe’s shots are
independent, then he’d have the same probability of hitting every shot
regardless of his past shots: 45%.</p>
<p>Now that we’ve phrased the situation in terms of independent shots,
let’s return to the question: how do we tell if Kobe’s shooting streaks
are long enough to indicate that he has hot hands? We can compare his
streak lengths to someone without hot hands: an independent shooter.</p>
<h3 id="simulations-in-r">Simulations in R</h3>
<p>While we don’t have any data from a shooter we know to have
independent shots, that sort of data is very easy to simulate in R. In a
simulation, you set the ground rules of a random process and then the
computer uses random numbers to generate an outcome that adheres to
those rules. As a simple example, you can simulate flipping a fair coin
with the following.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>outcomes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;heads&quot;</span>, <span class="st">&quot;tails&quot;</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">sample</span>(outcomes, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>The vector outcomes can be thought of as a hat with two slips of
paper in it: one slip says <code>heads</code> and the other says
<code>tails</code>. The function sample draws one slip from the hat and
tells us if it was a head or a tail.</p>
<p>Run the second command listed above several times. Just like when
flipping a coin, sometimes you’ll get a <code>heads</code>, sometimes
you’ll get a <code>tails</code>, but in the long run, you’d expect to
get roughly equal numbers of each.</p>
<p>If you wanted to simulate flipping a fair coin 100 times, you could
either run the function 100 times or, more simply, adjust the
<code>size</code> argument, which governs how many samples to draw (the
<code>replace = TRUE</code> argument indicates we put the slip of paper
back in the hat before drawing again). Save the resulting vector of
heads and tails in a new object called <code>sim_fair_coin</code>.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>sim_fair_coin <span class="ot">&lt;-</span> <span class="fu">sample</span>(outcomes, <span class="at">size =</span> <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>To view the results of this simulation, type the name of the object
and then use table to count up the number of heads and tails.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>sim_fair_coin</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(sim_fair_coin)</span></code></pre></div>
<p>Since there are only two elements in outcomes, the probability that
we “flip” a coin and it lands heads is 0.5. Say we’re trying to simulate
an unfair coin that we know only lands heads 20% of the time. We can
adjust for this by adding an argument called prob, which provides a
vector of two probability weights.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>sim_unfair_coin <span class="ot">&lt;-</span> <span class="fu">sample</span>(outcomes, <span class="at">size =</span> <span class="dv">100</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(<span class="fl">0.2</span>, <span class="fl">0.8</span>))</span></code></pre></div>
<p><code>prob=c(0.2, 0.8)</code> indicates that for the two elements in
the <code>outcomes</code> vector, we want to select the first one,
<code>heads</code>, with probability 0.2 and the second one,
<code>tails</code>, with probability 0.8. Another way of thinking about
this is to think of the outcome space as a bag of 10 chips, where 2
chips are labeled “head” and 8 chips “tail”. Therefore at each draw, the
probability of drawing a chip that says “head”” is 20%, and “tail” is
80%.</p>
<div class="exercise">
<p>In your simulation of flipping the unfair coin 100 times, how many
flips came up heads?</p>
</div>
<p>In a sense, we’ve shrunken the size of the slip of paper that says
“heads”, making it less likely to be drawn and we’ve increased the size
of the slip of paper saying “tails”, making it more likely to be drawn.
When we simulated the fair coin, both slips of paper were the same size.
This happens by default if you don’t provide a prob argument; all
elements in the outcomes vector have an equal probability of being
drawn.</p>
<p>If you want to learn more about sample or any other function, recall
that you can always check out its help file.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>?sample</span></code></pre></div>
<h3 id="simulating-the-independent-shooter">Simulating the Independent
Shooter</h3>
<p>Simulating a basketball player who has independent shots uses the
same mechanism that we use to simulate a coin flip. To simulate a single
shot from an independent shooter with a shooting percentage of 50% we
type,</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>outcomes <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;H&quot;</span>, <span class="st">&quot;M&quot;</span>)</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>sim_basket <span class="ot">&lt;-</span> <span class="fu">sample</span>(outcomes, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">replace =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>To make a valid comparison between Kobe and our simulated independent
shooter, we need to align both their shooting percentage and the number
of attempted shots.</p>
<div class="exercise">
<p>What change needs to be made to the sample function so that it
reflects a shooting percentage of 45%? Make this adjustment, then run a
simulation to sample 133 shots. Assign the output of this simulation to
a new object called <code>sim_basket</code>.</p>
</div>
<p>Note that we’ve named the new vector <code>sim_basket</code>, the
same name that we gave to the previous vector reflecting a shooting
percentage of 50%. In this situation, R overwrites the old object with
the new one, so always make sure that you don’t need the information in
an old vector before reassigning its name.</p>
<h3 id="comparing-kobe-to-the-independent-shooter">Comparing Kobe to the
Independent Shooter</h3>
<p>With the results of the simulation saved as <code>sim_basket</code>,
we have the data necessary to compare Kobe to our independent shooter.
We can look at Kobe’s data alongside our simulated data.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>kobe<span class="sc">$</span>basket</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>sim_basket</span></code></pre></div>
<p>Both data sets represent the results of 133 shot attempts, each with
the same shooting percentage of 45%. We know that our simulated data is
from a shooter that has independent shots. That is, we know the
simulated shooter does not have a hot hand.</p>
<div class="exercise">
<p>Using the function <code>streak_lengths</code>, compute the streak
lengths of <code>sim_basket</code>. Describe the distribution of streak
lengths. What is the typical streak length for this simulated
independent shooter with a 45% shooting percentage? How long is the
player’s longest streak of baskets in 133 shots?</p>
</div>
<div class="exercise">
<p>If you were to run the simulation of the independent shooter a second
time, how would you expect its streak distribution to compare to the
distribution from the question above? Exactly the same? Somewhat
similar? Totally different? Explain your reasoning.</p>
</div>
<div class="exercise">
<p>How does Kobe Bryant’s distribution of streak lengths compare to the
distribution of streak lengths for the simulated shooter? Using this
comparison, do you have evidence that the hot hand model fits Kobe’s
shooting patterns? Explain.</p>
</div>
<h2 id="lab4">Normal Distribution</h2>
<p>In this lab we’ll investigate the probability distribution that is
most central to statistics: the normal distribution. If we are confident
that our data are nearly normal, that opens the door to many powerful
statistical methods. Here we’ll use the graphical tools of R to assess
the normality of our data and also learn how to generate random numbers
from a normal distribution.</p>
<h3 id="the-data">The Data</h3>
<p>This week we’ll be working with measurements of body dimensions. This
data set contains measurements from 247 men and 260 women, most of whom
were considered healthy young adults.</p>
<p>Load the <code>csv</code> file located at <a
href="bdims.csv"><code>https://sagrawalx.github.io/teaching/fa21-b1_ma117/labs/bdims.csv</code></a>
and then take a quick peek at the first few rows of the data.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>bdims <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://sagrawalx.github.io/teaching/fa21-b1_ma117/labs/bdims.csv&quot;</span>)</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(bdims)</span></code></pre></div>
<p>You’ll see that for every observation we have 25 measurements, many
of which are either diameters or girths. A key to the variable names can
be found at <a href="http://www.openintro.org/stat/data/bdims.php"
class="uri">http://www.openintro.org/stat/data/bdims.php</a>, but we’ll
be focusing on just three columns to get started: weight in kg
(<code>wgt</code>), height in cm (<code>hgt</code>), and
<code>sex</code> (1 indicates male, 0 indicates female).</p>
<p>Since males and females tend to have different body dimensions, it
will be useful to create two additional data sets: one with only men and
another with only women.</p>
<p>Since males and females tend to have different body dimensions, it
will be useful to create two additional data sets: one with only men and
another with only women.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>mdims <span class="ot">&lt;-</span> <span class="fu">subset</span>(bdims, sex <span class="sc">==</span> <span class="dv">1</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>fdims <span class="ot">&lt;-</span> <span class="fu">subset</span>(bdims, sex <span class="sc">==</span> <span class="dv">0</span>)</span></code></pre></div>
<div class="exercise">
<p>Make a histogram of men’s heights and a histogram of women’s heights.
How would you compare the various aspects of the two distributions?</p>
</div>
<h3 id="the-normal-distribution">The Normal Distribution</h3>
<p>In your description of the distributions, did you use words like
bell-shaped or normal? It’s tempting to say so when faced with a
unimodal symmetric distribution.</p>
<p>To see how accurate that description is, we can plot a normal
distribution curve on top of a histogram to see how closely the data
follow a normal distribution. This normal curve should have the same
mean and standard deviation as the data. We’ll be working with women’s
heights, so let’s store them as a separate object and then calculate
some statistics that will be referenced later.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>fhgtmean <span class="ot">&lt;-</span> <span class="fu">mean</span>(fdims<span class="sc">$</span>hgt)</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>fhgtsd   <span class="ot">&lt;-</span> <span class="fu">sd</span>(fdims<span class="sc">$</span>hgt)</span></code></pre></div>
<p>Next we make a density histogram to use as the backdrop and use the
<code>lines</code> function to overlay a normal probability curve. The
difference between a frequency histogram and a density histogram is that
while in a frequency histogram the heights of the bars add up to the
total number of observations, in a density histogram the areas of the
bars add up to 1. The area of each bar can be calculated as simply the
height times the width of the bar. Using a density histogram allows us
to properly overlay a normal distribution curve over the histogram since
the curve is a normal probability density function. Frequency and
density histograms both display the same exact shape; they only differ
in their y-axis. You can verify this by comparing the frequency
histogram you constructed earlier and the density histogram created by
the commands below.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(fdims<span class="sc">$</span>hgt, <span class="at">probability =</span> <span class="cn">TRUE</span>)</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="dv">140</span><span class="sc">:</span><span class="dv">190</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">dnorm</span>(<span class="at">x =</span> x, <span class="at">mean =</span> fhgtmean, <span class="at">sd =</span> fhgtsd)</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">col =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p>After plotting the density histogram with the first command, we
create the x- and y-coordinates for the normal curve. We chose the
<code>x</code> range as 140 to 190 in order to span the entire range of
<code>fheight</code>. To create <code>y</code>, we use
<code>dnorm</code> to calculate the density of each of those x-values in
a distribution that is normal with mean <code>fhgtmean</code> and
standard deviation <code>fhgtsd</code>. The final command draws a curve
on the existing plot (the density histogram) by connecting each of the
points specified by x and y. The argument <code>col</code> simply sets
the color for the line to be drawn. If we left it out, the line would be
drawn in black.</p>
<p>The top of the curve is cut off because the limits of the x- and
y-axes are set to best fit the histogram. To adjust the y-axis you can
add a third argument to the histogram function:
<code>ylim = c(0, 0.06)</code>.</p>
<div class="exercise">
<p>Based on the this plot, does it appear that the data follow a nearly
normal distribution?</p>
</div>
<h3 id="evaluating-the-normal-distribution">Evaluating the Normal
Distribution</h3>
<p>Eyeballing the shape of the histogram is one way to determine if the
data appear to be nearly normally distributed, but it can be frustrating
to decide just how close the histogram is to the curve. An alternative
approach involves constructing a normal probability plot, also called a
normal Q-Q plot for “quantile-quantile.”</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(fdims<span class="sc">$</span>hgt)</span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(fdims<span class="sc">$</span>hgt)</span></code></pre></div>
<p>A data set that is nearly normal will result in a probability plot
where the points closely follow the line. Any deviations from normality
leads to deviations of these points from the line. The plot for female
heights shows points that tend to follow the line but with some errant
points towards the tails. We’re left with the same problem that we
encountered with the histogram above: how close is close enough?</p>
<p>A useful way to address this question is to rephrase it as: what do
probability plots look like for data that I know came from a normal
distribution? We can answer this by simulating data from a normal
distribution using rnorm.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>sim_norm <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">length</span>(fdims<span class="sc">$</span>hgt), <span class="at">mean =</span> fhgtmean, <span class="at">sd =</span> fhgtsd)</span></code></pre></div>
<p>The first argument indicates how many numbers you’d like to generate,
which we specify to be the same number of heights in the
<code>fdims</code> data set using the <code>length</code> function. The
last two arguments determine the mean and standard deviation of the
normal distribution from which the simulated sample will be generated.
We can take a look at the shape of our simulated data set,
<code>sim_norm</code>, as well as its normal probability plot.</p>
<div class="exercise">
<p>Make a normal probability plot of <code>sim_norm</code>. Do all of
the points fall on the line? How does this plot compare to the
probability plot for the real data?</p>
</div>
<p>Even better than comparing the original plot to a single plot
generated from a normal distribution is to compare it to many more plots
using the following function. Here’s a function which generates nine Q-Q
plots at the same time.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>qqnormsim <span class="ot">&lt;-</span> <span class="cf">function</span> (dat) {</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">3</span>))</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">qqnorm</span>(dat, <span class="at">main =</span> <span class="st">&quot;Normal QQ Plot (Data)&quot;</span>)</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">qqline</span>(dat)</span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">8</span>) {</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a>    simnorm <span class="ot">&lt;-</span> <span class="fu">rnorm</span>(<span class="at">n =</span> <span class="fu">length</span>(dat), <span class="at">mean =</span> <span class="fu">mean</span>(dat), </span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a>      <span class="at">sd =</span> <span class="fu">sd</span>(dat))</span>
<span id="cb70-8"><a href="#cb70-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">qqnorm</span>(simnorm, <span class="at">main =</span> <span class="st">&quot;Normal QQ Plot (Sim)&quot;</span>)</span>
<span id="cb70-9"><a href="#cb70-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">qqline</span>(simnorm)</span>
<span id="cb70-10"><a href="#cb70-10" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb70-11"><a href="#cb70-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span>
<span id="cb70-12"><a href="#cb70-12" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Copy the above into the console, and then use this function to
generate nine Q-Q plots for <code>fdims$hgt</code> as follows. It may be
helpful to click the zoom button in the plot window.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnormsim</span>(fdims<span class="sc">$</span>hgt)</span></code></pre></div>
<div class="exercise">
<p>Does the normal probability plot for <code>fdims$hgt</code> look
similar to the plots created for the simulated data? That is, do plots
provide evidence that the female heights are nearly normal?</p>
</div>
<div class="exercise">
<p>Using the same technique, determine whether or not female weights
appear to come from a normal distribution.</p>
</div>
<h3 id="normal-probabilities">Normal Probabilities</h3>
<p>Okay, so now you have a slew of tools to judge whether or not a
variable is normally distributed. Why should we care?</p>
<p>It turns out that statisticians know a lot about the normal
distribution. Once we decide that a random variable is approximately
normal, we can answer all sorts of questions about that variable related
to probability. Take, for example, the question of, “What is the
probability that a randomly chosen young adult female is taller than 6
feet (about 182 cm)?” (The study that published this data set is clear
to point out that the sample was not random and therefore inference to a
general population is not suggested. We do so here only as an
exercise.)</p>
<p>If we assume that female heights are normally distributed (a very
close approximation is also okay), we can find this probability by
calculating a Z score and consulting a Z table (also called a normal
probability table). In R, this is done in one step with the function
pnorm.</p>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span> <span class="sc">-</span> <span class="fu">pnorm</span>(<span class="at">q =</span> <span class="dv">182</span>, <span class="at">mean =</span> fhgtmean, <span class="at">sd =</span> fhgtsd)</span></code></pre></div>
<p>Note that the function <code>pnorm</code> gives the area under the
normal curve below a given value, <code>q</code>, with a given mean and
standard deviation. Since we’re interested in the probability that
someone is taller than 182 cm, we have to take one minus that
probability.</p>
<p>Assuming a normal distribution has allowed us to calculate a
theoretical probability. If we want to calculate the probability
empirically, we simply need to determine how many observations fall
above 182 then divide this number by the total sample size.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(fdims<span class="sc">$</span>hgt <span class="sc">&gt;</span> <span class="dv">182</span>) <span class="sc">/</span> <span class="fu">length</span>(fdims<span class="sc">$</span>hgt)</span></code></pre></div>
<p>Although the probabilities are not exactly the same, they are
reasonably close. The closer that your distribution is to being normal,
the more accurate the theoretical probabilities will be.</p>
<div class="exercise">
<p>Write out two probability questions that you would like to answer;
one regarding female heights and one regarding female weights. Calculate
the those probabilities using both the theoretical normal distribution
as well as the empirical distribution (four probabilities in all). Which
variable, height or weight, had a closer agreement between the two
methods?</p>
</div>
<div class="exercise">
<p>Now let’s consider some of the other variables in the body dimensions
data set. Using the figures below, match the histogram to its normal
probability plot. All of the variables have been standardized (first
subtract the mean, then divide by the standard deviation), so the units
won’t be of any help. If you are uncertain based on these figures,
generate the plots in R to check.</p>
<ol type="a">
<li>The histogram for female biiliac (pelvic) diameter
(<code>bii.di</code>) belongs to normal probability plot letter
____.</li>
<li>The histogram for female elbow diameter (<code>elb.di</code>)
belongs to normal probability plot letter ____.</li>
<li>The histogram for general age (<code>age</code>) belongs to normal
probability plot letter ____.</li>
<li>The histogram for female chest depth (<code>che.de</code>) belongs
to normal probability plot letter ____.</li>
</ol>
</div>
<p><img src="histqqmatch.png" width="100%"/></p>
<div class="exercise">
<p>As you can see, normal probability plots can be used both to assess
normality and visualize skewness. Make a normal probability plot for
female knee diameter (<code>kne.di</code>). Based on this normal
probability plot, is this variable left skewed, symmetric, or right
skewed? Use a histogram to confirm your findings.</p>
</div>
<h2 id="lab5">Foundations for statistical inference – Sampling
distributions</h2>
<p>In this lab, we investigate the ways in which the statistics from a
random sample of data can serve as point estimates for population
parameters. We’re interested in formulating a sampling distribution of
our estimate in order to learn about the properties of the estimate,
such as its distribution.</p>
<h3 id="the-data-1">The data</h3>
<p>We consider real estate data from the city of Ames, Iowa. The details
of every real estate transaction in Ames is recorded by the City
Assessor’s office. Our particular focus for this lab will be all
residential home sales in Ames between 2006 and 2010. This collection
represents our population of interest. In this lab we would like to
learn about these home sales by taking smaller samples from the full
population. Let’s load the data.</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a>ames <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://sagrawalx.github.io/teaching/fa21-b1_ma117/labs/ames.csv&quot;</span>)</span></code></pre></div>
<p>We see that there are quite a few variables in the data set, enough
to do a very in-depth analysis. For this lab, we’ll restrict our
attention to just two of the variables: the above ground living area of
the house in square feet (<code>Gr.Liv.Area</code>) and the sale price
(<code>SalePrice</code>). To save some effort throughout the lab, create
two variables with short names that represent these two variables.</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>area <span class="ot">&lt;-</span> ames<span class="sc">$</span>Gr.Liv.Area</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>price <span class="ot">&lt;-</span> ames<span class="sc">$</span>SalePrice</span></code></pre></div>
<p>Let’s look at the distribution of area in our population of home
sales by calculating a few summary statistics and making a
histogram.</p>
<pre><code>summary(area)
hist(area)</code></pre>
<div class="exercise">
<p>Describe this population distribution.</p>
</div>
<h3 id="the-unknown-sampling-distribution">The unknown sampling
distribution</h3>
<p>In this lab we have access to the entire population, but this is
rarely the case in real life. Gathering information on an entire
population is often extremely costly or impossible. Because of this, we
often take a sample of the population and use that to understand the
properties of the population.</p>
<p>If we were interested in estimating the mean living area in Ames
based on a sample, we can use the following command to survey the
population.</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>samp1 <span class="ot">&lt;-</span> <span class="fu">sample</span>(area, <span class="dv">50</span>)</span></code></pre></div>
<p>This command collects a simple random sample of size 50 from the
vector <code>area</code>, which is assigned to <code>samp1</code>. This
is like going into the City Assessor’s database and pulling up the files
on 50 random home sales. Working with these 50 files would be
considerably simpler than working with all 2930 home sales.</p>
<div class="exercise">
<p>Describe the distribution of this sample. How does it compare to the
distribution of the population?</p>
</div>
<p>If we’re interested in estimating the average living area in homes in
Ames using the sample, our best single guess is the sample mean.</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(samp1)</span></code></pre></div>
<p>Depending on which 50 homes you selected, your estimate could be a
bit above or a bit below the true population mean of 1499.69 square
feet. In general, though, the sample mean turns out to be a pretty good
estimate of the average living area, and we were able to get it by
sampling less than 3% of the population.</p>
<div class="exercise">
<p>Take a second sample, also of size 50, and call it
<code>samp2</code>. How does the mean of <code>samp2</code> compare with
the mean of <code>samp1</code>? Suppose we took two more samples, one of
size 100 and one of size 1000. Which would you think would provide a
more accurate estimate of the population mean?</p>
</div>
<p>Not surprisingly, every time we take another random sample, we get a
different sample mean. It’s useful to get a sense of just how much
variability we should expect when estimating the population mean this
way. The distribution of sample means, called the sampling distribution,
can help us understand this variability. In this lab, because we have
access to the population, we can build up the sampling distribution for
the sample mean by repeating the above steps many times. Here we will
generate 5000 samples and compute the sample mean of each.</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>sample_means50 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">5000</span>)</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5000</span>) {</span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a>   samp <span class="ot">&lt;-</span> <span class="fu">sample</span>(area, <span class="dv">50</span>)</span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a>   sample_means50[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(samp)</span>
<span id="cb79-6"><a href="#cb79-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb79-7"><a href="#cb79-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb79-8"><a href="#cb79-8" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(sample_means50)</span></code></pre></div>
<p>If you would like to adjust the bin width of your histogram to show a
little more detail, you can do so by changing the breaks argument.</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(sample_means50, <span class="at">breaks =</span> <span class="dv">25</span>)</span></code></pre></div>
<p>Here we use R to take 5000 samples of size 50 from the population,
calculate the mean of each sample, and store each result in a vector
called <code>sample_means50</code>. In the next section, we’ll review
how this set of code works.</p>
<div class="exercise">
<p>How many elements are there in <code>sample_means50</code>? Describe
the sampling distribution, and be sure to specifically note its center.
Would you expect the distribution to change if we instead collected
50,000 sample means?</p>
</div>
<h3 id="interlude-the-for-loop">Interlude: The <code>for</code>
loop</h3>
<p>Let’s take a break from the statistics for a moment to let that last
block of code sink in. You have just run your first <code>for</code>
loop, a cornerstone of computer programming. The idea behind the
<code>for</code> loop is iteration: it allows you to execute code as
many times as you want without having to type out every iteration. In
the case above, we wanted to iterate the two lines of code inside the
curly braces that take a random sample of size 50 from area then save
the mean of that sample into the <code>sample_means50</code> vector.
Without the for loop, this would be painful:</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>sample_means50 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">5000</span>)</span>
<span id="cb81-2"><a href="#cb81-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-3"><a href="#cb81-3" aria-hidden="true" tabindex="-1"></a>samp <span class="ot">&lt;-</span> <span class="fu">sample</span>(area, <span class="dv">50</span>)</span>
<span id="cb81-4"><a href="#cb81-4" aria-hidden="true" tabindex="-1"></a>sample_means50[<span class="dv">1</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(samp)</span>
<span id="cb81-5"><a href="#cb81-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-6"><a href="#cb81-6" aria-hidden="true" tabindex="-1"></a>samp <span class="ot">&lt;-</span> <span class="fu">sample</span>(area, <span class="dv">50</span>)</span>
<span id="cb81-7"><a href="#cb81-7" aria-hidden="true" tabindex="-1"></a>sample_means50[<span class="dv">2</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(samp)</span>
<span id="cb81-8"><a href="#cb81-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-9"><a href="#cb81-9" aria-hidden="true" tabindex="-1"></a>samp <span class="ot">&lt;-</span> <span class="fu">sample</span>(area, <span class="dv">50</span>)</span>
<span id="cb81-10"><a href="#cb81-10" aria-hidden="true" tabindex="-1"></a>sample_means50[<span class="dv">3</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(samp)</span>
<span id="cb81-11"><a href="#cb81-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb81-12"><a href="#cb81-12" aria-hidden="true" tabindex="-1"></a>samp <span class="ot">&lt;-</span> <span class="fu">sample</span>(area, <span class="dv">50</span>)</span>
<span id="cb81-13"><a href="#cb81-13" aria-hidden="true" tabindex="-1"></a>sample_means50[<span class="dv">4</span>] <span class="ot">&lt;-</span> <span class="fu">mean</span>(samp)</span></code></pre></div>
<p>and so on…</p>
<p>With the <code>for</code> loop, these thousands of lines of code are
compressed into a handful of lines. We’ve added one extra line to the
code below, which prints the variable <code>i</code> during each
iteration of the for loop. Run this code.</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>sample_means50 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">5000</span>)</span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5000</span>) {</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>   samp <span class="ot">&lt;-</span> <span class="fu">sample</span>(area, <span class="dv">50</span>)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a>   sample_means50[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(samp)</span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>   <span class="fu">print</span>(i)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Let’s consider this code line by line to figure out what it does. In
the first line we initialized a vector. In this case, we created a
vector of 5000 zeros called <code>sample_means50</code>. This vector
will will store values generated within the for loop.</p>
<p>The second line calls the <code>for</code> loop itself. The syntax
can be loosely read as, “for every element <code>i</code> from 1 to
5000, run the following lines of code.” You can think of <code>i</code>
as the counter that keeps track of which loop you’re on. Therefore, more
precisely, the loop will run once when <code>i = 1</code>, then once
when <code>i = 2</code>, and so on, up to <code>i = 5000</code>.</p>
<p>The body of the <code>for</code> loop is the part inside the curly
braces, and this set of code is run for each value of <code>i</code>.
Here, on every loop, we take a random sample of size 50 from area, take
its mean, and store it as the <code>i</code>th element of
<code>sample_means50</code>.</p>
<p>In order to display that this is really happening, we asked R to
print <code>i</code> at each iteration. This line of code is optional
and is only used for displaying what’s going on while the
<code>for</code> loop is running.</p>
<p>The <code>for</code> loop allows us to not just run the code 5000
times, but to neatly package the results, element by element, into the
empty vector that we initialized at the outset.</p>
<div class="exercise">
<p>To make sure you understand what you’ve done in this loop, try
running a smaller version. Initialize a vector of 100 zeros called
<code>sample_means_small</code>. Run a loop that takes a sample of size
50 from area and stores the sample mean in
<code>sample_means_small</code>, but only iterate from 1 to 100. Print
the output to your screen (type <code>sample_means_small</code> into the
console and press enter). How many elements are there in this object
called <code>sample_means_small</code>? What does each element
represent?</p>
</div>
<h3 id="sample-size-and-the-sampling-distribution">Sample size and the
sampling distribution</h3>
<p>Mechanics aside, let’s return to the reason we used a
<code>for</code> loop: to compute a sampling distribution, specifically,
this one.</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(sample_means50)</span></code></pre></div>
<p>The sampling distribution that we computed tells us much about
estimating the average living area in homes in Ames. Because the sample
mean is an unbiased estimator, the sampling distribution is centered at
the true average living area of the the population, and the spread of
the distribution indicates how much variability is induced by sampling
only 50 home sales.</p>
<p>To get a sense of the effect that sample size has on our
distribution, let’s build up two more sampling distributions: one based
on a sample size of 10 and another based on a sample size of 100.</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>sample_means10 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">5000</span>)</span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>sample_means100 <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">5000</span>)</span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5000</span>) {</span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  samp <span class="ot">&lt;-</span> <span class="fu">sample</span>(area, <span class="dv">10</span>)</span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  sample_means10[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(samp)</span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  samp <span class="ot">&lt;-</span> <span class="fu">sample</span>(area, <span class="dv">100</span>)</span>
<span id="cb84-8"><a href="#cb84-8" aria-hidden="true" tabindex="-1"></a>  sample_means100[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(samp)</span>
<span id="cb84-9"><a href="#cb84-9" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Here we’re able to use a single for loop to build two distributions
by adding additional lines inside the curly braces. Don’t worry about
the fact that <code>samp</code> is used for the name of two different
objects. In the second command of the for loop, the mean of
<code>samp</code> is saved to the relevant place in the vector
<code>sample_means10</code>. With the mean saved, we’re now free to
overwrite the object <code>samp</code> with a new sample, this time of
size 100. In general, anytime you create an object using a name that is
already in use, the old object will get replaced with the new one.</p>
<p>To see the effect that different sample sizes have on the sampling
distribution, plot the three distributions on top of one another.</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">1</span>))</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>xlimits <span class="ot">&lt;-</span> <span class="fu">range</span>(sample_means10)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb85-5"><a href="#cb85-5" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(sample_means10, <span class="at">breaks =</span> <span class="dv">20</span>, <span class="at">xlim =</span> xlimits)</span>
<span id="cb85-6"><a href="#cb85-6" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(sample_means50, <span class="at">breaks =</span> <span class="dv">20</span>, <span class="at">xlim =</span> xlimits)</span>
<span id="cb85-7"><a href="#cb85-7" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(sample_means100, <span class="at">breaks =</span> <span class="dv">20</span>, <span class="at">xlim =</span> xlimits)</span></code></pre></div>
<p>The first command specifies that you’d like to divide the plotting
area into 3 rows and 1 column of plots (to return to the default setting
of plotting one at a time, use <code>par(mfrow = c(1, 1))</code>). The
<code>breaks</code> argument specifies the number of bins used in
constructing the histogram. The <code>xlim</code> argument specifies the
range of the x-axis of the histogram, and by setting it equal to
<code>xlimits</code> for each histogram, we ensure that all three
histograms will be plotted with the same limits on the x-axis.</p>
<div class="exercise">
<p>When the sample size is larger, what happens to the center? What
about the spread?</p>
</div>
<p>So far, we have only focused on estimating the mean living area in
homes in Ames. Now you’ll try to estimate the mean home price.</p>
<div class="exercise">
<p>Take a random sample of size 50 from price. Using this sample, what
is your best point estimate of the population mean?</p>
</div>
<div class="exercise">
<p>Since you have access to the population, simulate the sampling
distribution for <span
class="math inline">\(\bar{x}_{\mathrm{price}}\)</span> by taking 5000
samples from the population of size 50 and computing 5000 sample means.
Store these means in a vector called <code>sample_means50</code>. Plot
the data, then describe the shape of this sampling distribution. Based
on this sampling distribution, what would you guess the mean home price
of the population to be? Finally, calculate and report the population
mean.</p>
</div>
<div class="exercise">
<p>Change your sample size from 50 to 150, then compute the sampling
distribution using the same method as above, and store these means in a
new vector called <code>sample_means150</code>. Describe the shape of
this sampling distribution. Based on this sampling distribution, what
would you guess to be the mean sale price of homes in Ames?</p>
</div>
<div class="exercise">
<p>Comprea the two sampling distributions from the previous two
exercises. Which one has a smaller spread? If we’re concerned with
making estimates that are more often close to the true value, would we
prefer a distribution with a large or small spread?</p>
</div>
<h2 id="lab6">Confidence intervals for categorical data</h2>
<p>In August of 2012, news outlets ranging from the <a
href="https://www.washingtonpost.com/national/on-faith/poll-shows-atheism-on-the-rise-in-the-us/2012/08/13/90020fd6-e57d-11e1-9739-eef99c5fb285_story.html">Washington
Post</a> to the <a
href="https://www.huffpost.com/entry/atheism-rise-religiosity-decline-in-america_n_1777031">Huffington
Post</a> ran a story about the rise of atheism in America. The source
for the story was a poll that asked people, “Irrespective of whether you
attend a place of worship or not, would you say you are a religious
person, not a religious person or a convinced atheist?” This type of
question, which asks people to classify themselves in one way or
another, is common in polling and generates categorical data. In this
lab we take a look at the atheism survey and explore what’s at play when
making inference about population proportions using categorical
data.</p>
<h3 id="the-survey">The survey</h3>
<p>To access the press release for the poll, conducted by WIN-Gallup
International, click on the following link: <a
href="https://github.com/OpenIntroStat/oilabs/raw/master/data-raw/atheism/Global_INDEX_of_Religiosity_and_Atheism_PR__6.pdf"
class="uri">https://github.com/OpenIntroStat/oilabs/raw/master/data-raw/atheism/Global_INDEX_of_Religiosity_and_Atheism_PR__6.pdf</a></p>
<p>Take a moment to review the report then address the following
questions.</p>
<div class="exercise">
<p>In the first paragraph, several key findings are reported. Do these
percentages appear to be sample statistics (derived from the data
sample) or population parameters?</p>
</div>
<div class="exercise">
<p>The title of the report is “Global Index of Religiosity and Atheism.”
To generalize the report’s findings to the global human population, what
must we assume about the sampling method? Does that seem like a
reasonable assumption?</p>
</div>
<h3 id="the-data-2">The data</h3>
<p>Turn your attention to Table 6 (pages 15 and 16), which reports the
sample size and response percentages for all 57 countries. While this is
a useful format to summarize the data, we will base our analysis on the
original data set of individual responses to the survey. Load this data
set into R with the following command.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a>atheism <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://sagrawalx.github.io/teaching/fa21-b1_ma117/labs/atheism.csv&quot;</span>)</span></code></pre></div>
<div class="exercise">
<p>What does each row of Table 6 correspond to? What does each row of
atheism correspond to?</p>
</div>
<p>To investigate the link between these two ways of organizing this
data, take a look at the estimated proportion of atheists in the United
States. Towards the bottom of Table 6, we see that this is 5%. We should
be able to come to the same number using the atheism data.</p>
<div class="exercise">
<p>Using the command below, create a new dataframe called us12 that
contains only the rows in atheism associated with respondents to the
2012 survey from the United States. Next, calculate the proportion of
atheist responses. Does it agree with the percentage in Table 6? If not,
why?</p>
</div>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>us12 <span class="ot">&lt;-</span> <span class="fu">subset</span>(atheism, nationality <span class="sc">==</span> <span class="st">&quot;United States&quot;</span> <span class="sc">&amp;</span> year <span class="sc">==</span> <span class="st">&quot;2012&quot;</span>)</span></code></pre></div>
<h3 id="inference-on-proportions">Inference on proportions</h3>
<p>As was hinted at in Exercise 1, Table 6 provides statistics, that is,
calculations made from the sample of 51,927 people. What we’d like,
though, is insight into the population parameters. You answer the
question, “What proportion of people in your sample reported being
atheists?” with a statistic; while the question “What proportion of
people on earth would report being atheists?” is answered with an
estimate of the parameter.</p>
<p>There are two main inferential tools for estimating population
proportions: confidence intervals and hypothesis tests. In this lab,
we’ll focus on confidence intervals.</p>
<div class="exercise">
<p>Write out the conditions for inference to construct a 95% confidence
interval for the proportion of atheists in the United States in 2012.
Are you confident all conditions are met?</p>
</div>
<p>Here’s a function that calculates the confidence interval. Copy and
paste the following code into R. (Note that there’s an in-built function
called <code>prop.test</code> that does something similar, but it
computes a different confidence interval than the one we’ve learned in
class! So you should use the following function.)</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>proportion.ci <span class="ot">=</span> <span class="cf">function</span>(x, <span class="at">conf.level =</span> <span class="fl">0.95</span>) {</span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Confidence Level: &quot;</span>, conf.level, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="fu">sum</span>(x)</span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>  n <span class="ot">&lt;-</span> <span class="fu">length</span>(x)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>  phat <span class="ot">&lt;-</span> k<span class="sc">/</span>n</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Sample Proportion: &quot;</span>, phat, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a>  se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(phat<span class="sc">*</span>(<span class="dv">1</span><span class="sc">-</span>phat)<span class="sc">/</span>n)</span>
<span id="cb88-8"><a href="#cb88-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Standard Error: &quot;</span>, se, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb88-9"><a href="#cb88-9" aria-hidden="true" tabindex="-1"></a>  zstar <span class="ot">&lt;-</span> <span class="fu">qnorm</span>(<span class="dv">1</span><span class="sc">-</span>(<span class="dv">1</span><span class="sc">-</span>conf.level)<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb88-10"><a href="#cb88-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Critical Z-Value: &quot;</span>, zstar, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb88-11"><a href="#cb88-11" aria-hidden="true" tabindex="-1"></a>  me <span class="ot">&lt;-</span> zstar <span class="sc">*</span> se</span>
<span id="cb88-12"><a href="#cb88-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(<span class="st">&quot;Margin of Error: &quot;</span>, me, <span class="st">&quot;</span><span class="sc">\n</span><span class="st">&quot;</span>)</span>
<span id="cb88-13"><a href="#cb88-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cat</span>(conf.level<span class="sc">*</span><span class="dv">100</span>, <span class="st">&quot;% Confidence Interval: (&quot;</span>, phat<span class="sc">-</span>me, <span class="st">&quot;, &quot;</span>, phat<span class="sc">+</span>me, <span class="st">&quot;)&quot;</span>)</span>
<span id="cb88-14"><a href="#cb88-14" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>This code defines a function, <code>proportion.ci</code>, which takes
as input a variable <code>x</code> which contains a list of boolean (ie,
<code>TRUE</code> or <code>FALSE</code>) values. It also takes an
optional argument, <code>conf.level</code>, to represent the confidence
level; this argument defaults to 0.95 if you don’t specify it.</p>
<p>Let’s now use this function to calculate a 95% confidence interval
for the proportion of atheists in the US in 2012:</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a><span class="fu">proportion.ci</span>(us12<span class="sc">$</span>response <span class="sc">==</span> <span class="st">&quot;atheist&quot;</span>)</span></code></pre></div>
<p>What’s going on here? Remember that <code>us12</code> is a data
frame, one of whose columns is <code>response</code>. The values that
<code>response</code> can take are either <code>atheist</code> or
<code>non-atheist</code>. The command
<code>us12$response == "atheist"</code> goes through each entry of the
column <code>us12$response</code> and outputs <code>TRUE</code> if that
entry is <code>atheist</code> and <code>FALSE</code> otherwise. In other
words, the output of <code>us12$response == "atheist"</code> is a list
of boolean values. We can then feed that list of boolean values into the
<code>proportion.ci</code> function.</p>
<div class="exercise">
<p>Based on the R output, what is the margin of error for the estimate
of the proportion of the proportion of atheists in US in 2012? What is
the confidence interval?</p>
</div>
<div class="exercise">
<p>Note that, since the <code>conf.level</code> argument to
<code>proportion.ci</code> defaults to 0.95, we could also calculate a
95% confidence interval using the <code>proportion.ci</code> function as
follows:</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="fu">proportion.ci</span>(us12<span class="sc">$</span>response <span class="sc">==</span> <span class="st">&quot;atheist&quot;</span>, <span class="at">conf.level =</span> <span class="fl">0.95</span>)</span></code></pre></div>
<p>Now use <code>proportion.ci</code> to calculate a 90% confidence
interval for the proportion of atheists in the US in 2012. Is this
confidence interval wider or narrower? Explain why this makes sense.</p>
</div>
<div class="exercise">
<p>Calculate 95% confidence intervals for the proportion of atheists in
2012 in two other countries of your choice, and report the associated
margins of error. Be sure to note whether the conditions for inference
are met. It may be helpful to create new data sets for each of the two
countries first, and then use these data sets in the
<code>proportion.ci</code> function to construct the confidence
intervals (just like you did for the US above).</p>
</div>
<h3 id="how-does-the-proportion-affect-the-margin-of-error">How does the
proportion affect the margin of error?</h3>
<p>Imagine you’ve set out to survey 1000 people on two questions: are
you female? and are you left-handed? Since both of these sample
proportions were calculated from the same sample size, they should have
the same margin of error, right? Wrong! While the margin of error does
change with sample size, it is also affected by the proportion.</p>
<p>Think back to the formula for the standard error: $ =$. This is then
used in the formula for the margin of error for a 95% confidence
interval: <span class="math display">\[\mathrm{ME}=1.96\times
\mathrm{SE}=1.96×\sqrt{p(1−p)/n}.\]</span> Since the population
proportion <span class="math inline">\(p\)</span> is in this <span
class="math inline">\(\mathrm{ME}\)</span> formula, it should make sense
that the margin of error is in some way dependent on the population
proportion. We can visualize this relationship by creating a plot of
<span class="math inline">\(\mathrm{ME}\)</span> vs. <span
class="math inline">\(p\)</span>.</p>
<p>The first step is to make a vector <code>p</code> that is a sequence
from 0 to 1 with each number separated by 0.01. We can then create a
vector of the margin of error (<code>me</code>) associated with each of
these values of <code>p</code> using the familiar approximate formula
(<span class="math inline">\(\mathrm{ME}=2\times \mathrm{SE}\)</span>).
Lastly, we plot the two vectors against each other to reveal their
relationship.</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1000</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="fl">0.01</span>)</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>me <span class="ot">&lt;-</span> <span class="dv">2</span> <span class="sc">*</span> <span class="fu">sqrt</span>(p <span class="sc">*</span> (<span class="dv">1</span> <span class="sc">-</span> p)<span class="sc">/</span>n)</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(me <span class="sc">~</span> p, <span class="at">ylab =</span> <span class="st">&quot;Margin of Error&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Population Proportion&quot;</span>)</span></code></pre></div>
<div class="exercise">
<p>Describe the relationship between <code>p</code> and
<code>me</code>.</p>
</div>
<h3 id="success-failure-condition">Success-failure condition</h3>
<p>The textbook emphasizes that you must always check conditions before
making inference. For inference on proportions, the sample proportion
can be assumed to be nearly normal if it is based upon a random sample
of independent observations and if both np≥10 and <span
class="math inline">\(n(1−p)\geq 10\)</span>. This rule of thumb is easy
enough to follow, but it makes one wonder: what’s so special about the
number 10?</p>
<p>The short answer is: nothing. You could argue that we would be fine
with 9 or that we really should be using 11. What is the “best” value
for such a rule of thumb is, at least to some degree, arbitrary.
However, when <span class="math inline">\(np\)</span> and <span
class="math inline">\(n(1−p)\)</span> reaches 10 the sampling
distribution is sufficiently normal to use confidence intervals and
hypothesis tests that are based on that approximation.</p>
<p>We can investigate the interplay between <span
class="math inline">\(n\)</span> and <span
class="math inline">\(p\)</span> and the shape of the sampling
distribution by using simulations. To start off, we simulate the process
of drawing 5000 samples of size 1040 from a population with a true
atheist proportion of 0.1. For each of the 5000 samples we compute <span
class="math inline">\(\hat{p}\)</span> and then plot a histogram to
visualize their distribution.</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>p <span class="ot">&lt;-</span> <span class="fl">0.1</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">1040</span></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a>p_hats <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>, <span class="dv">5000</span>)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5000</span>){</span>
<span id="cb92-6"><a href="#cb92-6" aria-hidden="true" tabindex="-1"></a>  samp <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">c</span>(<span class="st">&quot;atheist&quot;</span>, <span class="st">&quot;non_atheist&quot;</span>), n, <span class="at">replace =</span> <span class="cn">TRUE</span>, <span class="at">prob =</span> <span class="fu">c</span>(p, <span class="dv">1</span><span class="sc">-</span>p))</span>
<span id="cb92-7"><a href="#cb92-7" aria-hidden="true" tabindex="-1"></a>  p_hats[i] <span class="ot">&lt;-</span> <span class="fu">sum</span>(samp <span class="sc">==</span> <span class="st">&quot;atheist&quot;</span>)<span class="sc">/</span>n</span>
<span id="cb92-8"><a href="#cb92-8" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb92-9"><a href="#cb92-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-10"><a href="#cb92-10" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(p_hats, <span class="at">main =</span> <span class="st">&quot;p = 0.1, n = 1040&quot;</span>, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="fl">0.18</span>))</span></code></pre></div>
<p>These commands build up the sampling distribution of <span
class="math inline">\(\hat{p}\)</span> using the familiar
<code>for</code> loop. You can read the sampling procedure for the first
line of code inside the <code>for</code> loop as, “take a sample of size
n with replacement from the choices of atheist and non-atheist with
probabilities <code>p</code> and <code>1−p</code>, respectively.” The
second line in the loop says, “calculate the proportion of atheists in
this sample and record this value.” The loop allows us to repeat this
process 5000 times to build a good representation of the sampling
distribution.</p>
<div class="exercise">
<p>Describe the sampling distribution of sample proportions at <span
class="math inline">\(n=1040\)</span> and <span
class="math inline">\(p=0.1\)</span>. Be sure to note the center,
spread, and shape. Hint: Remember that R has functions such as mean to
calculate summary statistics.</p>
</div>
<div class="exercise">
<p>Repeat the above simulation three more times but with modified sample
sizes and proportions:</p>
<ul>
<li><span class="math inline">\(n=400\)</span> and <span
class="math inline">\(p=0.1\)</span>,</li>
<li><span class="math inline">\(n=1040\)</span> and <span
class="math inline">\(p=0.02\)</span>, and</li>
<li><span class="math inline">\(n=400\)</span> and <span
class="math inline">\(p=0.02\)</span>.</li>
</ul>
<p>Plot all four histograms together by running the
<code>par(mfrow = c(2, 2))</code> command before creating the
histograms. You may need to expand the plot window to accommodate the
larger two-by-two plot. Describe the three new sampling distributions.
Based on these limited plots, how does n appear to affect the
distribution of <span class="math inline">\(\hat{p}\)</span>? How does
<span class="math inline">\(p\)</span> affect the sampling
distribution?</p>
</div>
<p>Once you’re done, you can reset the layout of the plotting window by
using the command <code>par(mfrow = c(1, 1))</code> command or clicking
on “Clear All” above the plotting window (if using RStudio). Note that
the latter will get rid of all your previous plots.</p>
<div class="exercise">
<p>If you refer to Table 6, you’ll find that Australia has a sample
proportion of 0.1 on a sample size of 1040, and that Ecuador has a
sample proportion of 0.02 on 400 subjects. Let’s suppose for this
exercise that these point estimates are actually the truth. Then given
the shape of their respective sampling distributions, do you think it is
sensible to proceed with inference and report margin of errors, as the
reports does?</p>
</div>
<p>The question of atheism was asked by WIN-Gallup International in a
similar survey that was conducted in 2005. (We assume here that sample
sizes have remained the same.) Table 4 on page 13 of the report
summarizes survey results from 2005 and 2012 for 39 countries.</p>
<div class="exercise">
<p>Answer the following two questions. As always, write out the
hypotheses for any tests you conduct and outline the status of the
conditions for inference.</p>
<ol style="list-style: lower-alpha;">
<li>
Is there convincing evidence that Spain has seen a change in its atheism
index between 2005 and 2012? Hint: Create a new data set for respondents
from Spain. Form confidence intervals for the true proportion of
athiests in both years, and determine whether they overlap.
</li>
<li>
Is there convincing evidence that the United States has seen a change in
its atheism index between 2005 and 2012?
</li>
</ol>
</div>
<div class="exercise">
<p>If in fact there has been no change in the atheism index in the
countries listed in Table 4, in how many of those countries would you
expect to detect a change (at a significance level of 0.05) simply by
chance? Hint: Look in the textbook index under Type 1 error.</p>
</div>
<div class="exercise">
<p>Suppose you’re hired by the local government to estimate the
proportion of residents that attend a religious service on a weekly
basis. According to the guidelines, the estimate must have a margin of
error no greater than 1% with 95% confidence. You have no idea what to
expect for <span class="math inline">\(p\)</span>. How many people would
you have to sample to ensure that you are within the guidelines? Hint:
Refer to your plot of the relationship between <span
class="math inline">\(p\)</span> and margin of error. Do not use the
data set to answer this question.</p>
</div>
<h2 id="lab7">Confidence intervals for numerical data</h2>
<h3 id="sampling-from-ames-iowa">Sampling from Ames, Iowa</h3>
<p>If you have access to data on an entire population, say the size of
every house in Ames, Iowa, it’s straight forward to answer questions
like, “How big is the typical house in Ames?” and “How much variation is
there in sizes of houses?”. If you have access to only a sample of the
population, as is often the case, the task becomes more complicated.
What is your best guess for the typical size if you only know the sizes
of several dozen houses? This sort of situation requires that you use
your sample to make inference on what your population looks like. The
data</p>
<p>In a previous lab, we looked at the population data of houses from
Ames, Iowa. Let’s start by loading that data set.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>ames <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://sagrawalx.github.io/teaching/fa21-b1_ma117/labs/ames.csv&quot;</span>)</span></code></pre></div>
<p>In this lab we’ll start with a simple random sample of size 60 from
the population. Specifically, this is a simple random sample of size 60.
Note that the data set has information on many housing variables, but
for the first portion of the lab we’ll focus on the size of the house,
represented by the variable <code>Gr.Liv.Area</code>.</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>population <span class="ot">&lt;-</span> ames<span class="sc">$</span>Gr.Liv.Area</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>samp <span class="ot">&lt;-</span> <span class="fu">sample</span>(population, <span class="dv">60</span>)</span></code></pre></div>
<div class="exercise">
<p>Describe the distribution of your sample. What would you say is the
“typical” size within your sample? Also state precisely what you
interpreted “typical” to mean.</p>
</div>
<div class="exercise">
<p>Would you expect another student’s distribution to be identical to
yours? Would you expect it to be similar? Why or why not?</p>
</div>
<h3 id="confidence-intervals">Confidence intervals</h3>
<p>One of the most common ways to describe the typical or central value
of a distribution is to use the mean. In this case we can calculate the
mean of the sample using,</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>sample_mean <span class="ot">&lt;-</span> <span class="fu">mean</span>(samp)</span></code></pre></div>
<p>Return for a moment to the question that first motivated this lab:
based on this sample, what can we infer about the population? Based only
on this single sample, the best estimate of the average living area of
houses sold in Ames would be the sample mean, usually denoted as <span
class="math inline">\(\bar{x}\)</span> (here we’re calling it
<code>sample_mean</code>). That serves as a good point estimate but it
would be useful to also communicate how uncertain we are of that
estimate. This can be captured by using a confidence interval.</p>
<p>We can calculate a 95% confidence interval for a sample mean by
adding and subtracting 1.96 standard errors to the point estimate.</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">sd</span>(samp) <span class="sc">/</span> <span class="fu">sqrt</span>(<span class="dv">60</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>lower <span class="ot">&lt;-</span> sample_mean <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> se</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>upper <span class="ot">&lt;-</span> sample_mean <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> se</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(lower, upper)</span></code></pre></div>
<p>This is an important inference that we’ve just made: even though we
don’t know what the full population looks like, we’re 95% confident that
the true average size of houses in Ames lies between the values lower
and upper. There are a few conditions that must be met for this interval
to be valid.</p>
<div class="exercise">
<p>For the confidence interval to be valid, the sample mean must be
normally distributed and have standard error <span
class="math inline">\(s/\sqrt{n}\)</span>. What conditions must be met
for this to be true?</p>
</div>
<h3 id="confidence-levels">Confidence levels</h3>
<div class="exercise">
<p>What does “95% confidence” mean?</p>
</div>
<p>In this case we have the luxury of knowing the true population mean
since we have data on the entire population. This value can be
calculated using the following command:</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(population)</span></code></pre></div>
<div class="exercise">
<p>Does your confidence interval capture the true average size of houses
in Ames?</p>
</div>
<div class="exercise">
<p>All of your classmates should have gotten a slightly different
confidence interval. What proportion of those intervals would you expect
to capture the true population mean? Why?</p>
</div>
<p>Using R, we’re going to recreate many samples to learn more about how
sample means and confidence intervals vary from one sample to another.
Loops come in handy here! Here is the rough outline:</p>
<ol type="1">
<li>Obtain a random sample.</li>
<li>Calculate and store the sample’s mean and standard deviation.</li>
<li>Repeat steps (1) and (2) 50 times.</li>
<li>Use these stored statistics to calculate many confidence
intervals.</li>
</ol>
<p>But before we do all of this, we need to first create empty vectors
where we can save the means and standard deviations that will be
calculated from each sample. And while we’re at it, let’s also store the
desired sample size as <code>n</code>.</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>samp_mean <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">50</span>)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>samp_sd <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="cn">NA</span>, <span class="dv">50</span>)</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">60</span></span></code></pre></div>
<p>Now we’re ready for the loop where we calculate the means and
standard deviations of 50 random samples.</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">50</span>){</span>
<span id="cb99-2"><a href="#cb99-2" aria-hidden="true" tabindex="-1"></a>  samp <span class="ot">&lt;-</span> <span class="fu">sample</span>(population, n)</span>
<span id="cb99-3"><a href="#cb99-3" aria-hidden="true" tabindex="-1"></a>  samp_mean[i] <span class="ot">&lt;-</span> <span class="fu">mean</span>(samp)</span>
<span id="cb99-4"><a href="#cb99-4" aria-hidden="true" tabindex="-1"></a>  samp_sd[i] <span class="ot">&lt;-</span> <span class="fu">sd</span>(samp)</span>
<span id="cb99-5"><a href="#cb99-5" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>Lastly, we construct the confidence intervals.</p>
<div class="sourceCode" id="cb100"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>lower_vector <span class="ot">&lt;-</span> samp_mean <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> samp_sd <span class="sc">/</span> <span class="fu">sqrt</span>(n) </span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>upper_vector <span class="ot">&lt;-</span> samp_mean <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> samp_sd <span class="sc">/</span> <span class="fu">sqrt</span>(n)</span></code></pre></div>
<p>Lower bounds of these 50 confidence intervals are stored in
<code>lower_vector</code>, and the upper bounds are in
<code>upper_vector</code>. Let’s view the first interval.</p>
<div class="sourceCode" id="cb101"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a><span class="fu">c</span>(lower_vector[<span class="dv">1</span>], upper_vector[<span class="dv">1</span>])</span></code></pre></div>
<p>Here’s some code for plotting many confidence intervals and
highlighting the ones that don’t contain the true population meaan. It’s
lengthy and not terribly important to understand.</p>
<div class="sourceCode" id="cb102"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>contains <span class="ot">&lt;-</span> <span class="cf">function</span>(lo, hi, m) {</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>   <span class="cf">if</span>(m<span class="sc">&gt;=</span> lo <span class="sc">&amp;</span> m <span class="sc">&lt;=</span> hi) <span class="fu">return</span>(<span class="cn">TRUE</span>)</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>   <span class="cf">else</span> <span class="fu">return</span>(<span class="cn">FALSE</span>)</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>plot_ci <span class="ot">&lt;-</span> <span class="cf">function</span>(lo, hi, m) {</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">par</span>(<span class="at">mar=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>), <span class="at">mgp=</span><span class="fu">c</span>(<span class="fl">2.7</span>, <span class="fl">0.7</span>, <span class="dv">0</span>))</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>  k <span class="ot">&lt;-</span> <span class="dv">50</span></span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>  ci.max <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">rowSums</span>(<span class="fu">matrix</span>(<span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">*</span>lo,hi),<span class="at">ncol=</span><span class="dv">2</span>)))</span>
<span id="cb102-9"><a href="#cb102-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-10"><a href="#cb102-10" aria-hidden="true" tabindex="-1"></a>  xR <span class="ot">&lt;-</span> m <span class="sc">+</span> ci.max<span class="sc">*</span><span class="fu">c</span>(<span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>)</span>
<span id="cb102-11"><a href="#cb102-11" aria-hidden="true" tabindex="-1"></a>  yR <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">41</span><span class="sc">*</span>k<span class="sc">/</span><span class="dv">40</span>)</span>
<span id="cb102-12"><a href="#cb102-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb102-13"><a href="#cb102-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">plot</span>(xR, yR, <span class="at">type=</span><span class="st">&#39;n&#39;</span>, <span class="at">xlab=</span><span class="st">&#39;&#39;</span>, <span class="at">ylab=</span><span class="st">&#39;&#39;</span>, <span class="at">axes=</span><span class="cn">FALSE</span>)</span>
<span id="cb102-14"><a href="#cb102-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">abline</span>(<span class="at">v=</span>m, <span class="at">lty=</span><span class="dv">2</span>, <span class="at">col=</span><span class="st">&#39;#00000088&#39;</span>)</span>
<span id="cb102-15"><a href="#cb102-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">axis</span>(<span class="dv">1</span>, <span class="at">at=</span>m, <span class="fu">paste</span>(<span class="st">&quot;mu = &quot;</span>,<span class="fu">round</span>(m,<span class="dv">4</span>)), <span class="at">cex.axis=</span><span class="fl">1.15</span>)</span>
<span id="cb102-16"><a href="#cb102-16" aria-hidden="true" tabindex="-1"></a>  <span class="co">#axis(2)</span></span>
<span id="cb102-17"><a href="#cb102-17" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>k){</span>
<span id="cb102-18"><a href="#cb102-18" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">c</span>(hi[i],lo[i]))</span>
<span id="cb102-19"><a href="#cb102-19" aria-hidden="true" tabindex="-1"></a>      ci <span class="ot">&lt;-</span> <span class="fu">c</span>(lo[i],hi[i])</span>
<span id="cb102-20"><a href="#cb102-20" aria-hidden="true" tabindex="-1"></a>      <span class="cf">if</span>(<span class="fu">contains</span>(lo[i],hi[i],m)<span class="sc">==</span><span class="cn">FALSE</span>){</span>
<span id="cb102-21"><a href="#cb102-21" aria-hidden="true" tabindex="-1"></a>          col <span class="ot">&lt;-</span> <span class="st">&quot;#F05133&quot;</span></span>
<span id="cb102-22"><a href="#cb102-22" aria-hidden="true" tabindex="-1"></a>          <span class="fu">points</span>(x, i, <span class="at">cex=</span><span class="fl">1.4</span>, <span class="at">col=</span>col)</span>
<span id="cb102-23"><a href="#cb102-23" aria-hidden="true" tabindex="-1"></a><span class="co">#         points(x, i, pch=20, cex=1.2, col=col)</span></span>
<span id="cb102-24"><a href="#cb102-24" aria-hidden="true" tabindex="-1"></a>          <span class="fu">lines</span>(ci, <span class="fu">rep</span>(i, <span class="dv">2</span>), <span class="at">col=</span>col, <span class="at">lwd=</span><span class="dv">5</span>)</span>
<span id="cb102-25"><a href="#cb102-25" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb102-26"><a href="#cb102-26" aria-hidden="true" tabindex="-1"></a>      col <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb102-27"><a href="#cb102-27" aria-hidden="true" tabindex="-1"></a>    <span class="fu">points</span>(x, i, <span class="at">pch=</span><span class="dv">20</span>, <span class="at">cex=</span><span class="fl">1.2</span>, <span class="at">col=</span>col)</span>
<span id="cb102-28"><a href="#cb102-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">lines</span>(ci, <span class="fu">rep</span>(i, <span class="dv">2</span>), <span class="at">col=</span>col)</span>
<span id="cb102-29"><a href="#cb102-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb102-30"><a href="#cb102-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>After copying the above into the console, you can run it as
follows:</p>
<div class="sourceCode" id="cb103"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_ci</span>(lower_vector, upper_vector, <span class="fu">mean</span>(population))</span></code></pre></div>
<div class="exercise">
<p>What proportion of your confidence intervals include the true
population mean? Is this proportion exactly equal to the confidence
level? If not, explain why.</p>
</div>
<div class="exercise">
<p>Pick a confidence level of your choosing, provided it is not 95%.
What is the appropriate critical value?</p>
</div>
<div class="exercise">
<p>Calculate 50 confidence intervals at the confidence level you chose
in the previous question. You do not need to obtain new samples, simply
calculate new intervals based on the sample means and standard
deviations you have already collected. Using the <code>plot_ci</code>
function again, plot all intervals and calculate the proportion of
intervals that include the true population mean. How does this
percentage compare to the confidence level selected for the
intervals?</p>
</div>
<h2 id="lab8">Inference for numerical data</h2>
<h3 id="north-carolina-births">North Carolina births</h3>
<p>In 2004, the state of North Carolina released a large data set
containing information on births recorded in this state. This data set
is useful to researchers studying the relation between habits and
practices of expectant mothers and the birth of their children. We will
work with a random sample of observations from this data set.</p>
<h3 id="exploratory-analysis">Exploratory analysis</h3>
<p>Load the nc data set into our workspace.</p>
<div class="sourceCode" id="cb104"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>nc <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://sagrawalx.github.io/teaching/fa21-b1_ma117/labs/nc.csv&quot;</span>)</span></code></pre></div>
<p>We have observations on 13 different variables, some categorical and
some numerical. The meaning of each variable is as follows.</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">variable</th>
<th style="text-align: left;">description</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><code>fage</code></td>
<td style="text-align: left;">father’s age in years.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>mage</code></td>
<td style="text-align: left;">mother’s age in years.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>mature</code></td>
<td style="text-align: left;">maturity status of mother.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>weeks</code></td>
<td style="text-align: left;">length of pregnancy in weeks.</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>premie</code></td>
<td style="text-align: left;">whether the birth was classified as
premature (<code>premie</code>) or full-term.</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>visits</code></td>
<td style="text-align: left;">number of hospital visits during
`pregnancy</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>marital</code></td>
<td style="text-align: left;">whether mother is married or not married
at birth</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>gained</code></td>
<td style="text-align: left;">weight gained by mother during pregnancy
in pounds</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>weight</code></td>
<td style="text-align: left;">weight of the baby at birth in pounds</td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>lowbirthweight</code></td>
<td style="text-align: left;">whether baby was classified as low
birthweight (<code>low</code>) or not (<code>not low</code>).</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>gender</code></td>
<td style="text-align: left;">gender of the baby, <code>female</code> or
<code>male</code></td>
</tr>
<tr class="even">
<td style="text-align: left;"><code>habit</code></td>
<td style="text-align: left;">status of the mother as a
<code>nonsmoker</code> or a <code>smoker</code></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><code>whitemom</code></td>
<td style="text-align: left;">whether mom is <code>white</code> or
<code>not white</code></td>
</tr>
</tbody>
</table>
<div class="exercise">
<p>What are the observations in this data frame? How many observations
are there in our sample?</p>
</div>
<p>As a first step in the analysis, we should consider summaries of the
data. This can be done using the summary command:</p>
<div class="sourceCode" id="cb105"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nc)</span></code></pre></div>
<p>As you review the variable summaries, consider which variables are
categorical and which are numerical. For numerical variables, are there
outliers? If you aren’t sure or want to take a closer look at the data,
make a graph.</p>
<p>Consider the possible relationship between a mother’s smoking habit
and the weight of her baby. Plotting the data is a useful first step
because it helps us quickly visualize trends, identify strong
associations, and develop research questions.</p>
<div class="exercise">
<p>Make a side-by-side boxplot of <code>habit</code> and
<code>weight</code>. What does the plot highlight about the relationship
between these two variables?</p>
</div>
<p>The box plots show how the medians of the two distributions compare,
but we can also compare the means of the distributions using the
following function to split the weight variable into the habit groups,
then take the mean of each using the mean function.</p>
<div class="sourceCode" id="cb106"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">by</span>(nc<span class="sc">$</span>weight, nc<span class="sc">$</span>habit, mean)</span></code></pre></div>
<p>There is an observed difference, but is this difference statistically
significant? In order to answer this question we will conduct a
hypothesis test.</p>
<div class="exercise">
<p>Check if the conditions necessary for inference are satisfied. Note
that you will need to obtain sample sizes to check the conditions. You
can compute the group size using the same by command above but replacing
mean with length.</p>
</div>
<div class="exercise">
<p>Write the hypotheses for testing if the average weights of babies
born to smoking and non-smoking mothers are different.</p>
</div>
<p>We’ll now use the R function <code>t.test</code> to run a <span
class="math inline">\(t\)</span>-test for testing the hypothesis <span
class="math inline">\(H_0\)</span> that <span
class="math inline">\(\mu_{\text{smoker}} - \mu_{\text{nonsmoker}} =
0\)</span>, where <span
class="math inline">\(\mu_{\text{smoker}}\)</span> is the mean weight of
babies born to smoking mothers and <span
class="math inline">\(\mu_{\text{nonsmoker}}\)</span> is the mean weight
of babies born to nonsmoking mothers.</p>
<div class="sourceCode" id="cb107"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(nc<span class="sc">$</span>weight <span class="sc">~</span> nc<span class="sc">$</span>habit)</span></code></pre></div>
<div class="exercise">
<p>What is the <span class="math inline">\(p\)</span>-value of the <span
class="math inline">\(t\)</span>-test? What does this <span
class="math inline">\(p\)</span>-value mean?</p>
<p>Note: I’m asking you to interpret the <span
class="math inline">\(p\)</span>-value as a probability (not to make a
final conclusion about whether to reject or not reject <span
class="math inline">\(H_0\)</span> based on the <span
class="math inline">\(p\)</span>-value).</p>
</div>
<div class="exercise">
<p>What is a 95% confidence interval for <span
class="math inline">\(\mu_{\text{smoker}} -
\mu_{\text{nonsmoker}}\)</span>?</p>
<p>Note: Be careful about signs! The <code>t.test</code> function
outputs a confidence interval for either <span
class="math inline">\(\mu_{\text{smoker}} -
\mu_{\text{nonsmoker}}\)</span> or <span
class="math inline">\(\mu_{\text{nonsmoker}} -
\mu_{\text{smoker}}\)</span>. Which is it?</p>
</div>
<p>You can also use <code>t.test</code> for a single numerical variable.
For example, <code>weeks</code> is the variable recording the length of
the pregnancy. Run the following:</p>
<div class="sourceCode" id="cb108"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="fu">t.test</span>(nc<span class="sc">$</span>weeks) </span></code></pre></div>
<div class="exercise">
<p>What is the 95% confidence interval for the average length of
pregnancies? Interpret it in context.</p>
</div>
<div class="exercise">
<p>Calculate a new confidence interval for the same parameter at the 90%
confidence level. You can change the confidence level by adding a new
argument to the function: <code>conf.level = 0.90</code>.</p>
</div>
<div class="exercise">
<p>Conduct a hypothesis test evaluating whether the average weight
gained by younger mothers is different than the average weight gained by
mature mothers.</p>
</div>
<div class="exercise">
<p>Now, a non-inference task: Determine the age cutoff that was used in
this study for younger and mature mothers. Use a method of your choice,
and explain how your method works.</p>
</div>
<div class="exercise">
<p>Pick a pair of variables (one binary, one numerical) in this data set
and come up with a research question evaluating the relationship between
these variables. Formulate the question in a way that it can be answered
using a hypothesis test and/or a confidence interval. Answer your
question using the <code>t.test</code> function, report the statistical
results, and also provide an explanation in plain language.</p>
</div>
<h2 id="lab9">Introduction to linear regression</h2>
<h3 id="batter-up">Batter up</h3>
<p>The movie Moneyball focuses on the “quest for the secret of success
in baseball.” It follows a low-budget team, the Oakland Athletics, who
believed that underused statistics, such as a player’s ability to get on
base, betterpredict the ability to score runs than typical statistics
like home runs, RBIs (runs batted in), and batting average. Obtaining
players who excelled in these underused statistics turned out to be much
more affordable for the team.</p>
<p>In this lab we’ll be looking at data from all 30 Major League
Baseball teams and examining the linear relationship between runs scored
in a season and a number of other player statistics. Our aim will be to
summarize these relationships both graphically and numerically in order
to find which variable, if any, helps us best predict a team’s runs
scored in a season. The data</p>
<p>Let’s load up the data for the 2011 season.</p>
<div class="sourceCode" id="cb109"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>mlb11 <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;https://sagrawalx.github.io/teaching/fa21-b1_ma117/labs/mlb11.csv&quot;</span>)</span></code></pre></div>
<p>In addition to <code>runs</code> scored, there are seven
traditionally used variables in the data set: at-bats, hits, home runs,
batting average, strikeouts, stolen bases, and wins. There are also
three newer variables: on-base percentage, slugging percentage, and
on-base plus slugging. For the first portion of the analysis we’ll
consider the seven traditional variables. At the end of the lab, you’ll
work with the newer variables on your own.</p>
<div class="exercise">
<p>What type of plot would you use to display the relationship between
runs and one of the other numerical variables? Plot this relationship
using the variable <code>at_bats</code> as the predictor. Does the
relationship look linear? If you knew a team’s <code>at_bats</code>,
would you be comfortable using a linear model to predict the number of
runs?</p>
</div>
<p>If the relationship looks linear, we can quantify the strength of the
relationship with the correlation coefficient.</p>
<div class="sourceCode" id="cb110"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(mlb11<span class="sc">$</span>runs, mlb11<span class="sc">$</span>at_bats)</span></code></pre></div>
<p>Think back to the way that we described the distribution of a single
variable. Recall that we discussed characteristics such as center,
spread, and shape. It’s also useful to be able to describe the
relationship of two numerical variables, such as <code>runs</code> and
<code>at_bats</code> above.</p>
<div class="exercise">
<p>Looking at your plot from the previous exercise, describe the
relationship between these two variables. Make sure to discuss the form,
direction, and strength of the relationship as well as any unusual
observations.</p>
</div>
<h3 id="the-linear-model">The linear model</h3>
<p>We can use the <code>lm</code> function in R to fit the linear model
(a.k.a. regression line).</p>
<div class="sourceCode" id="cb111"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(runs <span class="sc">~</span> at_bats, <span class="at">data =</span> mlb11)</span></code></pre></div>
<p>The first argument in the function lm is a formula that takes the
form <code>y ~ x</code>. Here it can be read that we want to make a
linear model of runs as a function of <code>at_bats</code>. The second
argument specifies that R should look in the <code>mlb11</code> data
frame to find the <code>runs</code> and <code>at_bats</code>
variables.</p>
<p>The output of <code>lm</code> is an object that contains all of the
information we need about the linear model that was just fit. We can
access this information using the summary function.</p>
<div class="sourceCode" id="cb112"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m1)</span></code></pre></div>
<p>Let’s consider this output piece by piece. First, the formula used to
describe the model is shown at the top. After the formula you find the
five-number summary of the residuals. The “Coefficients” table shown
next is key; its first column displays the linear model’s y-intercept
and the coefficient of at_bats. With this table, we can write down the
least squares regression line for the linear model:</p>
<p><span class="math display">\[ \widehat{\mathrm{runs}} = −2789.2429 +
0.6305 \times \mathrm{at\_bats} \]</span></p>
<p>One last piece of information we will discuss from the summary output
is the Multiple R-squared, or more simply, <span
class="math inline">\(R^2\)</span>. The <span
class="math inline">\(R^2\)</span> value represents the proportion of
variability in the response variable that is explained by the
explanatory variable. For this model, 37.3% of the variability in runs
is explained by at-bats.</p>
<div class="exercise">
<p>Fit a new model that uses <code>homeruns</code> to predict
<code>runs</code>. Using the estimates from the R output, write the
equation of the regression line. What does the slope tell us in the
context of the relationship between success of a team and its home
runs?</p>
</div>
<h3 id="prediction-and-prediction-errors">Prediction and prediction
errors</h3>
<p>Let’s create a scatterplot with the least squares line laid on
top.</p>
<div class="sourceCode" id="cb113"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(mlb11<span class="sc">$</span>runs <span class="sc">~</span> mlb11<span class="sc">$</span>at_bats)</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(m1)</span></code></pre></div>
<p>The function <code>abline</code> plots a line based on its slope and
intercept. Here, we used a shortcut by providing the model
<code>m1</code>, which contains both parameter estimates. This line can
be used to predict <span class="math inline">\(y\)</span> at any value
of <span class="math inline">\(x\)</span>. When predictions are made for
values of <span class="math inline">\(x\)</span> that are beyond the
range of the observed data, it is referred to as extrapolation and is
not usually recommended. However, predictions made within the range of
the data are more reliable. They’re also used to compute the
residuals.</p>
<div class="exercise">
<p>If a team manager saw the least squares regression line and not the
actual data, how many runs would he or she predict for a team with 5579
at-bats? Is this an overestimate or an underestimate, and by how much?
In other words, what is the residual for this prediction?</p>
</div>
<h3 id="model-diagnostics">Model diagnostics</h3>
<p>To assess whether the linear model is reliable, we need to check for
(1) linearity, (2) nearly normal residuals, and (3) constant
variability.</p>
<p>Linearity: You already checked if the relationship between runs and
at-bats is linear using a scatterplot. We should also verify this
condition with a plot of the residuals vs. at-bats. Recall that any code
following a # is intended to be a comment that helps understand the code
but is ignored by R.</p>
<div class="sourceCode" id="cb114"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(m1<span class="sc">$</span>residuals <span class="sc">~</span> mlb11<span class="sc">$</span>at_bats)</span>
<span id="cb114-2"><a href="#cb114-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">h =</span> <span class="dv">0</span>, <span class="at">lty =</span> <span class="dv">3</span>)  <span class="co"># adds a horizontal dashed line at y = 0</span></span></code></pre></div>
<div class="exercise">
<p>Is there any apparent pattern in the residuals plot? What does this
indicate about the linearity of the relationship between runs and
at-bats?</p>
</div>
<p>Nearly normal residuals: To check this condition, we can look at a
histogram</p>
<div class="sourceCode" id="cb115"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="fu">hist</span>(m1<span class="sc">$</span>residuals)</span></code></pre></div>
<p>or a normal probability plot of the residuals.</p>
<div class="sourceCode" id="cb116"><pre
class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qqnorm</span>(m1<span class="sc">$</span>residuals)</span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a><span class="fu">qqline</span>(m1<span class="sc">$</span>residuals)  <span class="co"># adds diagonal line to the normal prob plot</span></span></code></pre></div>
<div class="exercise">
<p>Based on the histogram and the normal probability plot, does the
nearly normal residuals condition appear to be met?</p>
</div>
<p>Constant variability:</p>
<div class="exercise">
<p>Based on the plot in (1), does the constant variability condition
appear to be met?</p>
</div>
<div class="exercise">
<p>Choose another traditional variable from <code>mlb11</code> that you
think might be a good predictor of <code>runs</code>. Produce a
scatterplot of the two variables and fit a linear model. At a glance,
does there seem to be a linear relationship?</p>
</div>
<div class="exercise">
<p>How does this relationship compare to the relationship between runs
and at_bats? Use the <span class="math inline">\(R^2\)</span> values
from the two model summaries to compare. Does your variable seem to
predict <code>runs</code> better than <code>at_bats</code>? How can you
tell?</p>
</div>
<div class="exercise">
<p>Now that you can summarize the linear relationship between two
variables, investigate the relationships between runs and each of the
other five traditional variables. Which variable best predicts runs?
Support your conclusion using the graphical and numerical methods we’ve
discussed (for the sake of conciseness, only include output for the best
variable, not all five).</p>
</div>
<div class="exercise">
<p>Now examine the three newer variables. These are the statistics used
by the author of Moneyball to predict a teams success. In general, are
they more or less effective at predicting runs that the old variables?
Explain using appropriate graphical and numerical evidence. Of all ten
variables we’ve analyzed, which seems to be the best predictor of runs?
Using the limited (or not so limited) information you know about these
baseball statistics, does your result make sense?</p>
</div>
<div class="exercise">
<p>Check the model diagnostics for the regression model with the
variable you decided was the best predictor for runs.</p>
</div>

</main>

</body>

</html>
